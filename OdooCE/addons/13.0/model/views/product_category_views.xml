<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Budgetary Position -->
        <record id="budgetary_position_list_view_inherit" model="ir.ui.view">
            <field name="name">budgetary.position.list.view.inherit</field>
            <field name="model">account.budget.post</field>
            <field name="inherit_id" ref="account_budget.view_budget_post_tree"/>
            <field name="arch" type="xml">
                <field name="name" position="replace">
                    <field name="group_id"/>
                    <field name="name"/>
                    <field name="type"/>
                    <field name="margin_key"/>
                </field>
            </field>
        </record>

        <record id="budgetary_position_form_view_inherit" model="ir.ui.view">
            <field name="name">budgetary.position.form.view.inherit</field>
            <field name="model">account.budget.post</field>
            <field name="inherit_id" ref="account_budget.view_budget_post_form"/>
            <field name="arch" type="xml">
                <xpath expr="/form/sheet/group[1]" position="after">
                    <group>
                        <group>
                            <field name="sequence"/>
                        </group>
                        <group>
                            <field name="group_id"/>
                            <field name="type"/>
                            <field name="margin_key" domain="[('type','!=','margin')]"
                                attrs="{'invisible': [('type','!=','margin')],
                                        'required': [('type','=','margin')]}"/>
                        </group>
                    </group>
                </xpath>
            </field>
        </record>

        <!-- Product Category -->
        <record id="product_category_tree_view_inherit" model="ir.ui.view">
            <field name="name">product.category.tree.view.inherit</field>
            <field name="model">product.category</field>
            <field name="inherit_id" ref="product.product_category_list_view"/>
            <field name="arch" type="xml">
                <tree position="attributes">
                    <attribute name="action">[{
                        "name": "Update Sequence",
                        "act": "update_sequence_btn",
                        "views": [{"module": "aci_product", "xml_id": "update_sequence_wizard_form_view", "type": "form"}],
                        "src_model": "product.category",
                        "res_model": "update.sequence.wizard",
                        "context": {"source_model": "product.category"}
                    }]</attribute>
                </tree>

                <field name="display_name" position="replace">
                    <field name="sequence"/>
                    <field name="display_name"/>
                    <field name="type"/>
                    <field name="bom_type"/>
                    <field name="position_key"/>
                    <field name="bom_count"/>
                    <field name="total_bom_count"/>
                    <field name="template_count"/>
                    <field name="product_count"/>
                    <field name="route_ids" widget="many2many_tags"/>
                </field>
            </field>
        </record>

        <record id="product_category_form_view_inherit" model="ir.ui.view">
            <field name="name">product.category.form.view.inherit</field>
            <field name="model">product.category</field>
            <field name="inherit_id" ref="product.product_category_form_view"/>
            <field name="arch" type="xml">
                <field name="route_ids" position="replace"/>

                <field name="parent_id" position="after">
                    <field name="sequence" class="oe_inline"/>
                </field>

                <group name="first" position="after">
                    <group name="mrp_property" string="Manufacturing Properties" col="4">
                        <group colspan="2">
                            <field name="type"/>
                            <field name="position_key"
                                domain="[('type','!=','tax')]"
                                attrs="{'required': [('type','in',['normal', 'bom', 'labor'])],
                                        'invisible': [('type','in',['view', 'party'])]}"/>
                        </group>
                        <group colspan="2">
                            <field name="is_bom" invisible="1"/>
                            <field name="bom_type"
                                attrs="{'required': [('is_bom','=',True)],
                                        'invisible': [('is_bom','=',False)]}"/>
                            <field name="route_ids" widget="many2many_tags"
                                attrs="{'invisible': [('is_bom','=',False)]}"/>
                        </group>
                    </group>
                </group>

                <div name="button_box" position="replace">
                    <div class="oe_button_box" name="button_box">
                        <button type="action" name="%(product.product_category_action_form)d" class="oe_stat_button"
                            icon="fa-th-list" context="{'search_default_parent_id': id}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"><field name="child_count"/></span>
                                <span class="o_stat_text">Childs</span>
                            </div>
                        </button>
                        <button type="action" name="%(mrp.mrp_bom_form_action)d" class="oe_stat_button"
                            icon="fa-flask" context="{'search_default_categ_id': id, 'default_categ_id': id}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"><field name="bom_count"/>
                                / <field name="total_bom_count"/></span>
                                <span class="o_stat_text">Bill Of Materials</span>
                            </div>
                        </button>
                        <button type="action" name="%(product.product_template_action)d" class="oe_stat_button"
                            icon="fa-file-o" context="{'search_default_categ_id': id, 'default_categ_id': id}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"><field name="template_count"/></span>
                                <span class="o_stat_text">Templates</span>
                            </div>
                        </button>
                        <button type="action" name="%(product.product_normal_action)d" class="oe_stat_button"
                            icon="fa-files-o" context="{'search_default_categ_id': id}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"><field name="product_count"/></span>
                                <span class="o_stat_text">Variants</span>
                            </div>
                        </button>
                    </div>
                </div>
            </field>
        </record>

        <record id="product_category_search_view" model="ir.ui.view">
            <field name="name">product.category.search</field>
            <field name="model">product.category</field>
            <field name="mode">primary</field>
            <field name="priority" eval="0"/>
            <field name="inherit_id" ref="product.product_category_search_view"/>
            <field name="arch" type="xml">
                <field name="parent_id" position="after">
                    <field name="parent_path"/>
                    <field name="type" string="Category Type"/>
                    <field name="bom_type" string="Bill Of Material Type"/>
                    <field name="position_key" string="Budgetary Position Name"/>
                    <field name="position_type" string="Budgetary Position Type"/>
                    <separator string="Type"/>
                    <filter name="view" string="View" domain="[('type','=','view')]"/>
                    <filter name="party" string="Party" domain="[('type','=','party')]"/>
                    <filter name="labor" string="Crew &amp; Labor" domain="[('type','=','labor')]"/>
                    <filter name="simple" string="Simple" domain="[('type','=','normal')]"/>
                    <filter name="bom" string="Bill Of Material" domain="[('type','=','bom')]"/>
                    <separator string="BoM Type"/>
                    <filter name="budget" string="Budget" domain="[('bom_type','=','budget')]"/>
                    <filter name="phase" string="Phase" domain="[('bom_type','=','phase')]"/>
                    <filter name="production" string="Model" domain="[('bom_type','=','model')]"/>
                    <filter name="workorder" string="Workorders" domain="[('bom_type','=','workorder')]"/>
                    <filter name="basic" string="Basic" domain="[('bom_type','=','basic')]"/>
                    <separator string="Master Positions"/>
                    <filter name="material" string="Material"
                        domain="[('position_key','=',%(material_position)d)]"/>
                    <filter name="crew" string="Crew"
                        domain="[('position_key','=',%(aci_product.crew_position)d)]"/>
                    <filter name="labor" string="Labor"
                        domain="[('position_key','=',%(aci_product.labor_position)d)]"/>
                    <filter name="equipment" string="Equipment"
                        domain="[('position_key','=',%(equipment_position)d)]"/>
                    <filter name="tool" string="Tool"
                        domain="[('position_key','=',%(tool_position)d)]"/>
                    <filter name="semifinished" string="Semifinished"
                        domain="[('position_key','=',%(semifinished_position)d)]"/>
                    <filter name="subcontract" string="Subcontract"
                        domain="[('position_key','=',%(subcontract_position)d)]"/>
                    <filter name="land" string="Land"
                        domain="[('position_key','=',%(land_position)d)]"/>
                    <filter name="freight" string="Freight"
                        domain="[('position_key','=',%(freight_position)d)]"/>
                    <filter name="procedure" string="Procedure"
                        domain="[('position_key','=',%(procedure_position)d)]"/>
                    <filter name="management" string="Management"
                        domain="[('position_key','=',%(management_position)d)]"/>
                </field>
            </field>
        </record>

        <record id="product.product_category_action_form" model="ir.actions.act_window">
            <field name="search_view_id" ref="product_category_search_view"/>
        </record>

    </data>
</odoo>
