<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Product Template -->
        <record id="product_template_list_view_inherit" model="ir.ui.view">
            <field name="name">product.template.list.view.inherit</field>
            <field name="model">product.template</field>
            <field name="priority" eval="1"/>
            <field name="inherit_id" ref="product.product_template_tree_view"/>
            <field name="arch" type="xml">
                <xpath expr="//tree" position="attributes">
                    <attribute name="editable">top</attribute>
                    <attribute name="action">[{
                        "name": "Update Sequence",
                        "act": "update_sequence_btn",
                        "action": "aci_product.update_sequence_action",
                        "context": {"active_model": "product.template"}
                    },{
                        "name": "Update WBS Seq.",
                        "act": "update_wbs_btn",
                        "action": "aci_product.update_template_wbs_action",
                        "context": {"active_model": "product.template"}
                    },{
                        "name": "Update Variant Seq.",
                        "act": "update_product_btn",
                        "action": "aci_product.update_product_sequence_action",
                        "context": {"active_model": "product.template"}
                    },{
                        "name": "Create Template",
                        "mode": "model",
                        "act": "create_template_btn",
                        "action": "aci_product.create_product_template_wizard"
                    }]</attribute>
                </xpath>

                <field name="sequence" position="replace">
                    <field name="sequence" optional="show"/>
                    <field name="party_id" attrs="{'invisible': [('bom_type','!=','workorder')]}"/>
                    <field name="bom_type" readonly="1"/>
                </field>

                <field name="name" position="after">
                    <field name="attribute_ids" widget="many2many_tags" readonly="1" optional="show"/>
                    <field name="attribute_value_ids" widget="many2many_tags" optional="show"/>
                    <button type="object" name="show_form_btn" icon="fa-external-link" class="btn btn-default"/>
                </field>

                <field name="type" position="after">
                    <field name="position_key"/>
                </field>
            </field>
        </record>

        <record id="product_template_form_view_inherit" model="ir.ui.view">
            <field name="name">product.template.form.view.inherit</field>
            <field name="model">product.template</field>
            <field name="priority" eval="1"/>
            <field name="inherit_id" ref="mrp.product_template_form_view_bom_button"/>
            <field name="arch" type="xml">
                <field name="categ_id" position="replace"/>

                <button name="%(product.product_variant_action)d" position="attributes">
                    <attribute name="attrs">{'invisible': [('product_variant_count','=',0)]}</attribute>
                </button>
                <button name="%(mrp.template_open_bom)d" position="attributes">
                    <attribute name="attrs">{'invisible': [('bom_count','=',0)]}</attribute>
                </button>
                <button name="action_used_in_bom" position="attributes">
                    <attribute name="attrs">{'invisible': [('used_in_bom_count','=',0)]}</attribute>
                </button>

                <button name="%(product.product_attribute_value_action)d" position="before">
                    <button type="object" name="product_configurator_btn" string="Configure Attributes" class="btn-primary"/>
                    <button type="object" name="create_product_btn" string="Create Variants" class="btn-primary"/>
                </button>

                <field name="type" position="before">
                    <field name="sequence"/>
                </field>

                <xpath expr="//div[@name='options']" position="inside">
                    <div>
                        <field name="is_bom"/>
                        <label for="is_bom"/>
                    </div>
                    <div>
                        <field name="attribute_config"/>
                        <label for="attribute_config"/>
                    </div>
                </xpath>

                <xpath expr="//tree/field[@name='attribute_id']" position="replace">
                    <field name="sequence"/>
                    <field name="category_id" options="{'no_create': True}"/>
                    <field name="attribute_id" options="{'no_create': True}" domain="[('category_id', '=', category_id)]"/>
                </xpath>

                <xpath expr="/form/sheet/notebook/page[1]" position="after">
                    <page name="production_settings" string="Manufacturing">
                        <group col="4">
                            <group name="category" colspan="2">
                                <group colspan="2">
                                    <field name="categ_id" domain="[('type','!=','view')]" options="{'no_create': True}"/>
                                    <field name="position_key" readonly="1"/>
                                </group>
                            </group>
                            <group name="bom_resources" colspan="2" attrs="{'invisible': [('is_bom', '=', False)]}">
                                <group colspan="2">
                                    <field name="bom_type" readonly="1"/>
                                </group>
                                <group colspan="2" col="4" attrs="{'invisible': [('bom_type','!=','workorder')]}">
                                    <field name="party_id" colspan="4"
                                        options="{'no_create': True}"
                                        domain="[('categ_type','=','party')]"/>
                                    <field name="workcenter_id" colspan="4" options="{'no_create': True}"
                                        domain="[('template_id','=',False)]" attrs="{'required':[('bom_type','=','workorder')]}"/>
                                    <field name="min_members" colspan="2"
                                        attrs="{'required':[('bom_type','=','workorder')]}"/>
                                    <field name="max_members" colspan="2"
                                        attrs="{'required':[('bom_type','=','workorder')]}"/>
                                </group>
                            </group>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <record id="product_template_search_view" model="ir.ui.view">
            <field name="name">product.template.search</field>
            <field name="model">product.template</field>
            <field name="mode">primary</field>
            <field name="priority">1</field>
            <field name="inherit_id" ref="product.product_template_search_view"/>
            <field name="arch" type="xml">
                <xpath expr="/search" position="replace">
                    <search>
                        <field name="name"/>
                        <field name="categ_id"/>
                        <field name="categ_path"/>
                        <field name="attribute_ids" string="Attributes"/>
                        <field name="attribute_value_ids" string="Attribute Values"/>
                        <field name="attribute_line_ids" string="Attribute Lines"/>
                        <field name="party_id" />

                        <separator string="Type"/>
                        <filter name="party" string="Party" domain="[('categ_type','=','party')]"/>
                        <filter name="labor" string="Crew &amp; Labor" domain="[('categ_type','=','labor')]"/>
                        <filter name="simple" string="Simple" domain="[('categ_type','=','normal')]"/>
                        <filter name="bom" string="Bill Of Material" domain="[('categ_type','=','bom')]"/>

                        <separator string="BoM Types"/>
                        <filter name="budget" string="Budget" domain="[('bom_type', '=', 'budget')]"/>
                        <filter name="phase" string="Phase" domain="[('bom_type', '=', 'phase')]"/>
                        <filter name="production" string="Model" domain="[('bom_type', '=', 'model')]"/>
                        <filter name="workorder" string="Workorders" domain="[('bom_type', '=', 'workorder')]"/>
                        <filter name="basic" string="Basic" domain="[('bom_type', '=', 'basic')]"/>

                        <separator string="Master Positions"/>
                        <filter name="material" string="Material"
                            domain="[('position_key','=',%(material_position)d)]"/>
                        <filter name="crew" string="Crew"
                            domain="[('position_key','=',%(aci_product.crew_position)d)]"/>
                        <filter name="labor" string="Labor"
                            domain="[('position_key','=',%(aci_product.labor_position)d)]"/>
                        <filter name="equipment" string="Equipment"
                            domain="[('position_key','=',%(equipment_position)d)]"/>
                        <filter name="tool" string="Tool"
                            domain="[('position_key','=',%(tool_position)d)]"/>
                        <filter name="semifinished" string="Semifinished"
                            domain="[('position_key','=',%(semifinished_position)d)]"/>
                        <filter name="subcontract" string="Subcontract"
                            domain="[('position_key','=',%(subcontract_position)d)]"/>
                        <filter name="land" string="Land"
                            domain="[('position_key','=',%(land_position)d)]"/>
                        <filter name="freight" string="Freight"
                            domain="[('position_key','=',%(freight_position)d)]"/>
                        <filter name="procedure" string="Procedure"
                            domain="[('position_key','=',%(procedure_position)d)]"/>
                        <filter name="management" string="Management"
                            domain="[('position_key','=',%(management_position)d)]"/>
                    </search>
                </xpath>
            </field>
        </record>

        <record id="product.product_template_action" model="ir.actions.act_window">
            <field name="name">Product Templates</field>
            <field name="domain"></field>
            <field name="search_view_id" ref="product_template_search_view"/>
        </record>

        <record id="mrp.product_template_action" model="ir.actions.act_window">
            <field name="context">{}</field>
        </record>

        <!-- Product variant -->
        <record id="product_product_list_view" model="ir.ui.view">
            <field name="name">product.product.list.view</field>
            <field name="model">product.product</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <tree create="false" action='[{
                    "name": "Set Price List",
                    "act": "set_pricelist_btn",
                    "views": [{"module": "aci_mrp_plm", "xml_id": "update_product_pricelist_wizard_form", "type": "form"}],
                    "src_model": "product.product",
                    "res_model": "update.product.price.wizard"
                },{
                    "name": "Recompute Price List",
                    "act": "compute_price_btn",
                    "mode": "model",
                    "views": [{"module": "aci_mrp_plm", "xml_id": "update_product_price_wizard_form", "type": "form"}],
                    "src_model": "product.product",
                    "res_model": "update.product.price.wizard"
                },{
                    "name": "Update Sequence",
                    "act": "update_sequence_btn",
                    "action": "aci_product.update_sequence_action",
                    "context": {"active_model": "product.product"}
                }]' editable="top">
                    <field name="sequence" optional="show"/>
                    <field name="categ_id" readonly="1"/>
                    <field name="complete_name"/>
                    <button type="object" name="show_form_btn"
                        icon="fa-external-link" class="btn btn-default"/>
                    <field name="product_template_attribute_value_ids"
                        widget="many2many_tags" optional="show" readonly="1"/>
                    <field name="position_key"/>
                    <field name="pricelist_id" optional="show"/>
                    <field name="standard_price" optional="show"/>
                    <field name="fasar_base" optional="show"/>
                    <field name="fasar_factor" optional="show"/>
                    <field name="context_price" optional="show"/>
                    <field name="uom_id" options="{'no_open': True, 'no_create': True}"
                        groups="uom.group_uom" optional="show"/>
                    <field name="has_bom" optional="show"/>
                    <field name="lst_price" optional="show"/>
                    <field name="product_tmpl_id" invisible="1"/>
                    <field name="active" invisible="1"/>
                    <field name="price" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="product_product_form_view_inherit" model="ir.ui.view">
            <field name="name">product.product.form.view.inherit</field>
            <field name="model">product.product</field>
            <field name="priority">1</field>
            <field name="inherit_id" ref="mrp.product_product_form_view_bom_button"/>
            <field name="arch" type="xml">
                <button name="%(product.product_attribute_value_action)d" position="before">
                    <button type="object" name="product_configurator_btn"
                        string="Configure Attributes" class="btn-primary"/>
                </button>

                <field name="type" position="before">
                    <field name="sequence"/>
                </field>
                <field name="name" position="replace">
                        <field name="name" invisible="1"/>
                </field>
                <field name="product_tmpl_id" position="replace">
                    <field name="product_tmpl_id" class="oe_inline" readonly="1" attrs="{'required': [('id', '!=', False)]}"/>
                </field>
                <xpath expr="//page[@name='general_information']" position="after">
                    <page name="production_settings" string="Manufacturing">
                        <group>
                            <group name="bom_resources" string="Resources"
                                attrs="{'invisible': [('is_bom','=',False)]}">
                                <group colspan="2">
                                    <field name="bom_type" readonly="1"/>
                                </group>
                                <group colspan="2" col="4" attrs="{'invisible': [('bom_type','!=','workorder')]}">
                                    <field name="party_id" colspan="4"
                                        options="{'no_create': True}"
                                        domain="[('categ_type','=','party')]"/>
                                    <field name="workcenter_id" colspan="4" options="{'no_create': True}"
                                        domain="[('template_id','=',False)]" attrs="{'required':[('bom_type','=','workorder')]}"/>
                                    <field name="min_members" colspan="2"
                                        attrs="{'required':[('bom_type','=','workorder')]}"/>
                                    <field name="max_members" colspan="2"
                                        attrs="{'required':[('bom_type','=','workorder')]}"/>
                                </group>
                            </group>
                            <group name="context_price" string="Context Price"
                                attrs="{'invisible': [('is_bom','=',True)]}">
                                <group>
                                    <field name="manual_price"/>
                                    <field name="pricelist_id" attrs="{'invisible':[('manual_price','=',True)]}"/>
                                    <field name="position_key" invisible="1"/>
                                    <field name="categ_type" invisible="1"/>
                                    <field name="is_bom" invisible="1"/>
                                </group>
                                <group>
                                    <field name="fasar_base"
                                        attrs="{'invisible': [('categ_type','!=','labor')]}"/>
                                    <field name="fasar_factor"
                                        attrs="{'invisible': [('categ_type','!=','labor')]}"/>
                                    <field name="context_price"
                                        attrs="{
                                        'readonly': [('manual_price','=',False)],
                                        'invisible': [('categ_type','=','labor')]}"/>
                                </group>
                            </group>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <record id="product_product_search_view" model="ir.ui.view">
            <field name="name">product.product.search</field>
            <field name="model">product.product</field>
            <field name="mode">primary</field>
            <field name="priority">1</field>
            <field name="inherit_id" ref="product_template_search_view"/>
            <field name="arch" type="xml">
                <field name="attribute_line_ids" position="replace">
                    <field name="product_tmpl_id"/>
                    <field name="product_template_attribute_value_ids"/>
                    <field name="neodata_id"/>
                </field>
            </field>
        </record>

        <record id="stock.stock_product_normal_action" model="ir.actions.act_window">
            <field name="name">Product Variants</field>
            <field name="search_view_id" ref="product_template_search_view"/>
        </record>

    </data>
</odoo>
