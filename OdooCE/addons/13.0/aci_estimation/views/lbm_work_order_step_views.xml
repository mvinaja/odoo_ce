<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="lbm_work_order_step_tree_view" model="ir.ui.view">
        <field name="name">lbm.work.order.step.tree.view</field>
        <field name="model">lbm.work.order.step</field>
        <field name="arch" type="xml">
            <tree create="0" decoration-muted="timetracking_active == False">
                <field name="timetracking_active" invisible="1"/>
                <field name="product_id" readonly="1"/>
                <field name="workorder_id"/>
                <field name="stage_id" optional="hidden"/>
                <field name="wkcenter" readonly="1" optional="show"/>
                <field name="extra_cost"/>
                <field name="accum_time" string="Effective Time (Hrs.)" widget="float_time"/>
                 <field name="has_timetracking" invisible="1"/>
                 <field name="has_tracking" invisible="1"/>
<!--                <button name="delete_tracking_btn"-->
<!--                        string="Reset Tracking"-->
<!--                        icon="fa-calendar-times-o"-->
<!--                        help="Delete Inputs"-->
<!--                        type="object"-->
<!--                        attrs="{'invisible': [-->
<!--                                    ('has_tracking', '=', False)-->
<!--                                ]}"/>-->
                <button name="show_tracking_btn"
                        string="Show Tracking"
                        icon="fa-activity-sm"
                        help="Show Tracking"
                        type="object"
                        attrs="{'invisible': [
                                    ('has_timetracking', '=', False)
                                ]}"/>
            </tree>
        </field>
    </record>


    <record id="lbm_work_order_step_form_view" model="ir.ui.view">
        <field name="name">lbm.work.order.step.form.view</field>
        <field name="model">lbm.work.order.step</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <form string="Work Order Step" create="false">
                <sheet>
                    <div class="oe_title">
                        <label class="oe_edit_only" for="name" string="Step Name"/>
                        <h1><field name="product_id" placeholder="Step Name" readonly="1"/></h1>
                        <div name="options" groups="base.group_user">
                        </div>
                    </div>
                    <group colspan="4" col="2">
                        <field name="wkcenter" readonly="1"/>
                        <field name="workorder_id" readonly="1"/>
                        <field name="production_id" readonly="1"/>
                        <field name="workstep_id" readonly="1"/>
                        <field name="warehouse_id" readonly="1"/>
                        <field name="available_wo_qty_progress" string="Available W.O. Qty" readonly="1"/>
                    </group>
                    <notebook>
                        <page string="Tracking Records">
                            <field name="tracking_ids" nolabel="1">
                                <tree create="false" editable="top" delete="false" decoration-danger="is_productivity==False">
                                    <field name="workorder_id" invisible="1"/>
                                    <field name="analytic_id"
                                           options="{'no_create': True, 'no_open': True}"/>
                                    <field name="date_start" readonly="1"/>
                                    <field name="final_start_date"/>
                                    <field name="date_end" readonly="1"/>
                                    <field name="final_end_date"/>
                                    <field name="duration" readonly="1" widget="float_time"/>
                                    <field name="qty_manual" readonly="1"/>
                                    <field name="progress" readonly="1"/>
                                    <field name="qty_progress" readonly="1"
                                        attrs="{'required': [('qty_operators', '!=', False), ('qty_operators', '>', 0)]}"/>
                                    <field name="rate_uom"/>
                                    <field name="qty_operators" readonly="1"
                                        attrs="{'required': [('qty_progress', '!=', False), ('qty_progress', '>', 0)]}"/>
                                    <field name="resource_id" readonly="1" string="Work Center"/>
                                    <field name="loss_id" readonly="1" string="Efficiency"/>
                                    <field name="is_productivity" invisible="1"/>
                                      <button name="open_form" icon="fa-external-link-square" type="object" help="Open"
                                            context="{'id_domain': id}"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Rate">
                            <group colspan="4" col="2">
                                <field name="rate" string="Rate"/>
                                <field name="rate_uom"/>
                                <field name="time_uom"/>
                                <field name="product_qty"/>
                                <field name="min_members"/>
                                <field name="max_members"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids" options="{'open_attachments': True}"/>
                </div>
            </form>
        </field>
    </record>


    <record id="lbm_work_order_step_filter_view" model="ir.ui.view">
        <field name="name">lbm.work.order.step.filter.view</field>
        <field name="model">lbm.work.order.step</field>
        <field name="arch" type="xml">
            <search string="Search operation">
                <field name="product_id" string="Name"/>
                <field name="wkcenter" string="Workcenter"/>
                <field name="stage_id" string="Stage"/>
                <separator/>
                 <filter
                    name="active_steps"
                    string="Current Week"
                    domain="[('date_planned', '&lt;=', context.get('date_planned', datetime.datetime.now().strftime('%Y-%m-%d 00:00:00')))]"/>
                <filter name="six_weeks" string="6 weeks ahead"
                            domain="[
                                '&amp;',
                                ('date_planned', '>=', (context_today()).strftime('%Y-%m-%d')),
                                ('date_planned', '&lt;=', (context_today() + relativedelta(weeks=6)).strftime('%Y-%m-%d')),
                    ]"/>
                <filter name="tracked_steps" string="Worked Steps"
                    domain="[('accum_time', '>', 0)]"/>
                <separator/>
                    <filter name="stage_finish" string="Stage Finished" domain="[('stage_id.name', '=', 'Finished')]"/>
                    <filter name="stage_workink" string="Stage Working" domain="[('stage_id.name', '=', 'Working')]"/>
                    <filter name="stage_stop" string="Stage To Do" domain="[('stage_id.name', '=', 'ToDo')]"/>
                    <filter name="stage_blocked" string="Stage Blocked" domain="[('stage_id.name', '=', 'Blocked')]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter name="Work_order" string="Work Order" context="{'group_by':'workorder_id'}"/>
                    <separator/>
                    <filter name="Work_center" string="Work Center" context="{'group_by':'wkcenter'}"/>
                    <separator/>
                     <filter name="Production" string="Production" context="{'group_by':'production_id'}"/>
                </group>
                <separator/>
                <field name="production_id" string="Production"/>
                <field name="workorder_id" string="Operation"/>
                <field name="warehouse_id" string="Warehouse"/>
                <field name="product_id" string="Product"/>
            </search>
        </field>
    </record>

    <record id="lbm_work_order_step_tree_action" model="ir.actions.act_window">
        <field name="name">Work Order Steps</field>
        <field name="res_model">lbm.work.order.step</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="lbm_work_order_step_tree_view"/>
        <field name="target">current</field>
    </record>

    <menuitem id="menu_aci_gamification_steps"
        name="Steps"
        parent="mrp.menu_mrp_manufacturing"
        action="lbm_work_order_step_tree_action"
        sequence="10"/>
</odoo>