<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="mrp_estimation_view_search" model="ir.ui.view">
        <field name="name">mrp.estimation.view.search</field>
        <field name="model">mrp.estimation</field>
        <field name="arch" type="xml">
            <search>
                <field name="warehouse_id"/>
                <field name="period_id"/>
                <field name="estimation_type"/>
                <field name="workcenter_id"/>
                <field name="employee_id"/>
                <separator/>
                <filter name="filter_periodic_estimation" string="Period" domain="[('estimation_type', '=', 'period')]" />
                <filter name="filter_daily_estimation" string="Daily" domain="[('estimation_type', '=', 'daily')]" />
            </search>
        </field>
    </record>

     <record id="mrp_estimation_tree_view" model="ir.ui.view">
        <field name="name">mrp.estimation.tree.view</field>
        <field name="model">mrp.estimation</field>
        <field name="arch" type="xml">
            <tree create="false"
            decoration-muted="expected_duration &lt;= 0"
            decoration-success="duration &gt; 0">
                <field name="warehouse_id"  optional="show"/>
                <field name="period_group_id" optional="hidden"/>
                <field name="period_id" optional="show"/>
                <field name="workcenter_code" optional="show"/>
                <field name="workcenter_role" optional="show"/>
                <field name="set_operators" optional="show"/>
                <field name="employee_id" optional="show"/>
                <field name="expected_duration" invisible="1" optional="show"/>
                <field name="expected_duration_hours" optional="show"/>
                <field name="duration" invisible="1" optional="show"/>
                <field name="duration_hours" optional="show"/>
                <button name="show_estimation_end_calculator_btn" string="" type="object" icon="fa-step-forward"
                            help="Change Block End"
                            attrs="{'invisible': [('duration','&lt;=', 0)]}"/>
                <field name="estimation_end" optional="show"/>
                <field name="estimated_duration_hours" optional="show"/>
                <field name="period_status"  optional="show"/>
            </tree>
        </field>
    </record>
    <record id="mrp_estimation_daily_tree_view" model="ir.ui.view">
        <field name="name">mrp.estimation.daily.tree.view</field>
        <field name="model">mrp.estimation</field>
        <field name="arch" type="xml">
            <tree create="false"
             action='[{
                        "title": "Create Act. Block",
                        "icon": "btn-secondary fa fa-sign-in",
                        "act": "create_multiple_activity_block_btn",
                        "method": "create_multiple_activity_block_btn",
                        "src_model": "mrp.estimation"
                        },{
                        "title": "LogIn Crew",
                        "icon": "btn-secondary fa fa-user-plus",
                        "act": "create_crew_activity_block",
                        "views": [{"module": "aci_estimation", "xml_id": "mrp_estimation_crew_wizard_form_view",
                                 "type": "form"}],
                        "binding_model": "mrp.estimation",
                        "res_model": "mrp.estimation.crew.wizard",
                        "mode": "model"
                        }]'
            decoration-muted="expected_duration &lt;= 0"
            decoration-success="duration &gt; 0">
                <field name="warehouse_id" optional="hidden"/>
                <field name="estimation_type" optional="hidden"/>
                <field name="can_create_block" invisible="1"/>
                <button type="object" name="create_activity_block_btn" style="color:green;"
                        attrs="{'invisible': [('can_create_block', '=', False)]}"
                        icon="fa-sign-in" help="Create Activity Block"/>
                <field name="crew_logged" invisible="1"/>
                <button type="object" name="create_crew_activity_block_btn" style="color:green;"
                        attrs="{'invisible': ['|', ('estimation_type', '=', 'period'),
                            ('crew_logged', '=', True)]}"
                        icon="fa-user-plus" help="Sign-in Crew"/>
                <button type="object" name="create_crew_activity_block_btn" style="color:red;"
                        attrs="{'invisible': ['|', ('estimation_type', '=', 'period'),
                            ('crew_logged', '=', False)]}"
                        icon="fa-user-plus" help="Sign-in Crew"/>
                <field name="day"  optional="show"/>
                <field name="period_group_id" optional="hidden"/>
                <field name="period_id" optional="show"/>
                <field name="workcenter_code" optional="show"/>
                <field name="workcenter_role" optional="show"/>
                <field name="set_operators" optional="show"/>
                <field name="employee_id" optional="show"/>
                <field name="expected_duration" invisible="1" optional="show"/>
                <field name="expected_duration_hours" optional="show"/>
                <field name="duration" invisible="1" optional="show"/>
                <field name="duration_hours" optional="show"/>
                <button name="show_estimation_end_calculator_btn" string="" type="object" icon="fa-step-forward"
                            help="Change Block End"
                            attrs="{'invisible': [('duration','&lt;=', 0)]}"/>
                <field name="estimation_end" optional="show"/>
                <field name="estimated_duration_hours" optional="show"/>
            </tree>
        </field>
    </record>
        <record id="mrp_estimation_form_view" model="ir.ui.view">
            <field name="name">mrp.estimation.form.view</field>
            <field name="model">mrp.estimation</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <field name="expected_duration" invisible="1"/>
                        <field name="estimated_duration" invisible="1"/>
                        <button string="Cancel" name="set_canceled_btn"
                                type="object" class="oe_highlight btn-danger"
                                confirm="Are you sure you want to continue?"
                                attrs="{'invisible': ['|', ('expected_duration', '&gt;', 0),
                                                      ('estimated_duration', '&gt;', 0)]}"/>
                        <button string="Open" name="set_open_btn"
                                type="object" class="oe_highlight"
                                attrs="{'invisible': [('period_status', 'not in', (False, 'waiting_approval'))]}"/>
                        <button string="Close" name="set_waiting_btn"
                                type="object" class="oe_highlight"
                                attrs="{'invisible': [('period_status', '!=', 'open')]}"/>
                        <button string="Payable" name="set_payable_btn"
                                type="object" class="oe_highlight"
                                attrs="{'invisible': [('period_status', '!=', 'waiting_approval')]}"/>
                        <button string="Pay" name="set_paid_btn" type="object" class="oe_highlight"
                                attrs="{'invisible': [('period_status', '!=', 'payable')]}"/>
                         <field name="period_status" widget="statusbar"  statusbar_visible="draft,open,waiting_approval,payable,paid"
                         attrs="{'invisible': [('estimation_type', '!=', 'period')]}"/>
                     </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <field name="can_create_block" invisible="1"/>

                        <button type="object" name="daily_estimation_btn" class="oe_stat_button"
                                attrs="{'invisible': [('estimation_type', '!=', 'period')]}"
                                icon="fa-calendar-plus-o" hekp="Daily estimations">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"> <field name="daily_count" readonly="1"/></span>
                                <span class="o_stat_text">Daily</span>
                            </div>
                        </button>
                        <button type="object" name="create_activity_block_btn" class="oe_stat_button"
                                attrs="{'invisible': [('can_create_block', '=', False)]}" help="Create Activity Block"
                                icon="fa-sign-in" style="color:green">
                            <span class="o_stat_text">Create Act. Block</span>
                        </button>
                        <button type="object" name="activity_block_btn" class="oe_stat_button"
                                icon="fa-tasks" help="Show Activity Block">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"> <field name="duration_hours" readonly="1"/></span>
                                <span class="o_stat_text">On Act. Block</span>
                            </div>
                        </button>
                        <button type="object" name="planned_tracking_btn" class="oe_stat_button"
                                icon="fa-calendar-check-o" help="Planned Activity">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"> <field name="expected_duration_hours" readonly="1"/></span>
                                <span class="o_stat_text">Planned</span>
                            </div>
                        </button>
                            <button type="object" name="show_workorder_tracking_btn" class="oe_stat_button"
                                icon="fa-workorder-sm" help="Tracking by Workorder">
                            <span class="o_stat_text">WorkOrder</span>
                            </button>
                            <button type="object" name="show_step_tracking_btn" class="oe_stat_button"
                                    icon="fa-step-sm"  help="Tracking by Step">
                                <span class="o_stat_text">Step</span>
                            </button>
                            <button type="object" name="productivity_btn" class="oe_stat_button"
                                    attrs="{'invisible': [('estimation_type', '!=', 'period')]}"
                                    icon="fa-pencil" help="Show Inputs">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_value"> <field name="estimated_duration_hours" readonly="1"/></span>
                                    <span class="o_stat_text">Input</span>
                                </div>
                            </button>
                            <button type="object" name="cost_productivity_btn" class="oe_stat_button"
                                    groups="aci_estimation.group_estimation_manager"
                                    attrs="{'invisible': [('estimation_type', '!=', 'period')]}"
                                    icon="fa-money" help="Show estimation costs">
                                <div class="o_field_widget o_stat_info">
                                     <span class="o_stat_value"> <field name="cost_count" readonly="1"/></span>
                                    <span class="o_stat_text">Cost</span>
                                </div>
                            </button>
                            <button type="object" name="planned_periodic_tracking_btn" class="oe_stat_button"
                                    attrs="{'invisible': [('estimation_type', '!=', 'period')]}"
                                    icon="fa-calendar-plus-o" help="Periodic Activity">
                                <div class="o_field_widget o_stat_info">
                                    <span class="o_stat_value"> <field name="periodic_count" readonly="1"/></span>
                                    <span class="o_stat_text">Periodic</span>
                                </div>
                            </button>
                        </div>
               <header>
<!--                   <field name="is_closed" invisible="1"/>-->
                   <field name="workcenter_id" invisible="1"/>
                   <field name="warehouse_id" invisible="1"/>
                   <field name="active_on_period" invisible="1"/>
                   <field name="estimation_type" invisible="1"/>
                  <button type="object" name="update_planned_btn" icon="fa-clock-o" help="Update tracking activity"
                           string="Update Planned" class="btn-primary"
                   attrs="{'invisible': ['|', ('period_status', '!=', 'open'), ('estimation_type', '!=', 'period')]}"/>
                  <button type="object" name="update_tracking_btn" icon="fa-clock-o" help="Update Inputs"
                           string="Update Input" class="btn-primary"
                   attrs="{'invisible': ['|', ('period_status', '!=', 'open'), ('estimation_type', '!=', 'period')]}"/>
                   <button type="object" name="update_activity_block_btn" icon="fa-refresh" help="Update Activity Blocks"
                           string="Activity Blocks" class="btn-secondary"
                   attrs="{'invisible': ['|', ('period_status', '!=', 'open'), ('estimation_type', '!=', 'period')]}"/>
                   <button type="object" name="update_estimation_btn" icon="fa-refresh" help="Update Estimation"
                           string="Restore" class="btn-secondary"
                           confirm="Are you sure you want to update the estimation? This will erase any unsaved data"
                           attrs="{'invisible': ['|',  ('period_status', '!=', 'open'),
                                                 ('estimation_type', '!=', 'period')]}"/>
                </header>
                    <h2>
                        <field name="employee_id"/>
                    </h2>
                    <group col="4">
                        <field name="approve_employee_id" attrs="{'required': [('period_status','=', 'waiting_approval')],
                                                                  'invisible': [('estimation_type', '=', 'daily')]}"/>
                        <field name="supervisor_employee_id" attrs="{'required': [('period_status','=', 'waiting_approval')],
                                                                     'invisible': [('estimation_type', '=', 'daily')]}"/>
                        <field name="estimation_type" readonly="1"/>
                        <field name="workcenter_role"/>
                        <field name="set_operators"/>
                        <field name="day" attrs="{'invisible': [('estimation_type', '!=', 'daily')]}" readonly="1"/>
                        <field name="period_group_id" readonly="1"/>
                        <field name="period_id" readonly="1"/>
<!--                        <field name="is_closed" invisible="1"/>-->
<!--                        <label for="period_id"/>-->
<!--                        <div class="o_row">-->
<!--                            <field name="period_id" readonly="1"/>-->
<!--                            <i class="fa fa-lock" role="img" aria-label="Closed" title="Closed"-->
<!--                                attrs="{'invisible': [('is_closed', '=', False)]}"/>-->
<!--                            <i class="fa fa-unlock" role="img" aria-label="Open" title="Open"-->
<!--                                attrs="{'invisible': [('is_closed', '=', True)]}"/>-->
<!--                        </div>-->
                        <field name="start_period"/>
                        <field name="end_period"/>
                    </group>
                    </sheet>
                </form>
            </field>
        </record>

    <record id="mrp_estimation_workcenter_view_search" model="ir.ui.view">
        <field name="name">mrp.estimation.workcenter.search</field>
        <field name="model">mrp.estimation.workcenter</field>
        <field name="arch" type="xml">
            <search string="Product Search">
                <field name="workcenter_id"/>
                <field name="employee_id"/>
                <field name="department_id"/>
                <filter string="Supervisor" name="supervisor" domain="[('is_supervisor','=', True)]"/>
                <filter string="Empty Operators" domain="[('employee_id','=',None)]"/>
                <group expand="0" string="Group By">
                    <filter name="group_by_department" string="Department" context="{'group_by': 'department_id'}"/>
                </group>
                <searchpanel>
                    <field name="department_id" icon="fa-users"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <record id="mrp_estimation_workcenter_tree_view" model="ir.ui.view">
        <field name="name">mrp.estimation.workcenter.tree.view</field>
        <field name="model">mrp.estimation.workcenter</field>
        <field name="arch" type="xml">
            <tree editable="top" create="0" delete="0"
                  decoration-success="active_on_period == True"

            action='[{
                        "name": "Start Activity",
                        "act": "button_selection_start_estimation",
                        "method": "button_selection_start_estimation",
                        "src_model": "mrp.estimation.workcenter"
                    },{
                        "name": "End Activity",
                        "act": "button_selection_end_estimation",
                        "method": "button_selection_end_estimation",
                        "src_model": "mrp.estimation.workcenter"
                    },{
                        "name": "Create Activity Block",
                        "act": "button_selection_start_special_estimation",
                        "views": [{"module": "aci_estimation", "xml_id": "mrp_timetracking_activity_wizard_form_view", "type": "form"}],
                        "binding_model": "mrp.estimation.workcenter",
                        "res_model": "mrp.timetracking.activity.wizard",
                        "mode": "model"
                    }]'>
                <field name="active_on_period" invisible="1"/>
                <field name="on_calendar" invisible="1"/>
                <field name="block_origin" invisible="1"/>
                <button style="color:green" name="button_start_activity_estimation" type="object"
                        help="Start Activity"
                        attrs="{'invisible': [('block_origin', 'in', ('calendar', 'extra'))]}"
                        icon="fa-sign-in" />
                <button  name="button_timeoff" type="object"
                        help="TimeOff" icon="fa-timeoff-xs" />
                <button style="color:red;" name="button_end_activity_estimation" type="object"
                        help="End Activity"
                        attrs="{'invisible': [('block_origin', 'not in', ('calendar', 'extra'))]}" icon="fa-sign-out" />
                <button style="color:red;" name="button_end_day" type="object"
                        icon="fa-window-close" help="End Day"/>
                <field name="workcenter_code" readonly="1"/>
                <field name="employee_id" readonly="1"/>
                <field name="has_contract" readonly="1"/>
                <button type="object" name="show_assign_section_btn" icon="fa-activity-sm" help="Assign Section"/>
                <field name="number_estimation"/>
                <field name="has_estimation" invisible="1"/>
                <button name="button_estimate_block" type="object" help="Estimate Block" icon="fa-estimation-sm"/>
                <field name="final_start_date" readonly="1"/>
                <field name="final_end_date" readonly="1"/>
                <field name="block_id" invisible="1"/>
                <field name="block_type" invisible="1"/>
                <field name="block_type" readonly="1"/>
                <field name="contract_tolerance" invisible="1"/>
                <field name="attendance_block_start_date" readonly="1"/>
                <field name="attendance_block_id" readonly="1"/>
                <field name="on_extra_block" invisible="1"/>
                <field name="on_approved_incidence" invisible="1"/>
                <field name="on_extra_time" invisible="1"/>
                <field name="missing_incidence" invisible="1"/>
                <button name="button_tracking_log" type="object"
                        help="Show Tracking Log" icon="fa-step-xxs" />
                <button  name="button_leaves" type="object"
                        help="Show Leaves" icon="fa-sun-o" />
                <button  name="button_blocks" type="object"
                        help="Blocks" icon="fa-block-sm" />
                <button class="btn btn-warning" name="button_missing_incidence" type="object"
                         help="Incidences" icon="fa-warning"
                        attrs="{'invisible': [('missing_incidence', '=', False)]}"/>
            </tree>
        </field>
    </record>

    <record id="mrp_estimation_workcenter_baseline_tree_view" model="ir.ui.view">
        <field name="name">mrp.estimation.workcenter.baseline.tree.view</field>
        <field name="model">mrp.estimation.workcenter</field>
        <field name="arch" type="xml">
            <tree editable="top" create="0" delete="0"
                decoration-success="active_on_period == True"
                action='[{
                        "name": "Tracking&#8592;&#8594;Estimation",
                        "act": "button_change_estimation",
                        "method": "button_change_estimation",
                        "src_model": "mrp.estimation.workcenter"}]'>
                <field name="active_on_period" invisible="1"/>
                <field name="workcenter_code" readonly="1"/>
                <field name="employee_id" readonly="1"/>
                <field name="has_contract" readonly="1"/>
                <field name="activity_count" readonly="1"/>
                <button type="object" name="show_assign_section_btn" icon="fa-list" help="Assign Section"/>
                <field name="number_estimation"/>
                <button name="button_estimate_block"
                        type="object" help="Estimate Block" icon="fa-clock-o"/>
                <field name="is_supervisor" readonly="1"/>
                <field name="supervised_count" attrs="{'invisible': [('is_supervisor', '=', False)]}"
                       readonly="1"/>
                <button name="button_supervised"  attrs="{'invisible': [('is_supervisor', '=', False)]}"
                        type="object" help="Estimate Block" icon="fa-user"/>
            </tree>
        </field>
    </record>

    <record id="mrp_estimation_workcenter_analytic_tree_view" model="ir.ui.view">
            <field name="name">mrp.estimation.workcenter.analytic.tree.view</field>
            <field name="model">mrp.estimation.workcenter</field>
            <field name="arch" type="xml">
                <tree create="false">
                    <field name="department_id"/>
                    <field name="workcenter_id"/>
                    <field name="workcenter_code"/>
                    <field name="employee_id"/>
                </tree>
            </field>
        </record>

    <record id="mrp_estimation_workcenter_analytic_form_view" model="ir.ui.view">
        <field name="name">mrp.estimation.workcenter.form.view</field>
        <field name="model">mrp.estimation.workcenter</field>
        <field name="arch" type="xml">
            <form string="MO Work Centers">
                <sheet>
                    <h1><field name="workcenter_id" readonly="1"/></h1>
                    <group name="description">
                        <field name="workcenter_code"/>
                        <field name="department_id" readonly="1"/>
                        <field name="employee_id"/>
<!--                        <field name="status"/>-->
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="mrp_production_workcenter_action" model="ir.actions.act_window">
        <field name="name">Workcenters on Production</field>
        <field name="res_model">mrp.estimation.workcenter</field>
        <field name="view_mode">tree,form</field>
        <field name="target">current</field>
        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('mrp_estimation_workcenter_analytic_tree_view')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('mrp_estimation_workcenter_analytic_form_view')})]"/>
        <field name="search_view_id" ref="mrp_estimation_workcenter_view_search"/>
    </record>

    <menuitem id="menu_mrp_production_workcenter"
    name="Workcenters on Production"
    parent="mrp.menu_mrp_manufacturing"
    action="mrp_production_workcenter_action"
    sequence="25"/>

    <record id="ir_actions_server_manual_estimation" model="ir.actions.server">
        <field name="name">Run Estimation Daemon</field>
        <field name="model_id" ref="aci_estimation.model_mrp_estimation"/>
        <field name="state">code</field>
        <field name="code">action = model._create_estimation()</field>
    </record>

</odoo>