<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Attendance incidence tree view -->
    <record id="attendance_incidence_tree_view" model="ir.ui.view">
        <field name="name">attendance.incidence.tree.view</field>
        <field name="model">attendance.incidence</field>
        <field name="arch" type="xml">
            <tree action='[{
                        "name": "Create Incidences",
                        "act": "create_incidences_btn",
                        "views": [{"module": "aci_estimation", "xml_id": "create_multi_incidence_form_view", "type": "form"}],
                        "src_model": "attendance.incidence",
                        "res_model": "attendance.incidence.actions",
                        "mode": "model"
                    }]' create="0">
                <field name="is_computed" invisible="1"/>
                <field name="type_incidence"
                    attrs="{'readonly': [('is_computed', '=', True)]}"/>
                <field name="name"
                    attrs="{'readonly': [('is_computed', '=', True)]}"/>
                <field name="employee_id"
                    attrs="{'readonly': [('is_computed', '=', True)]}"/>
                <field name="structure_type_id"/>
                <field name="date_computed"/>
                <field name="day_computed"/>
                <field name="check_in_hour" widget="float_time"/>
                <field name="check_out_hour" widget="float_time"/>
                <field name="period_id"/>
                <field name="created_by_user"/>
                <field name="qty_real_logs"/>
                <field name="productivity_block"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <!-- Attendance incidence form view -->
    <record id="attendance_incidence_form_view" model="ir.ui.view">
        <field name="name">attendance.incidence.form.view</field>
        <field name="model">attendance.incidence</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="approve_incidence_button" states="draft" string="Approve" type="object" class="oe_highlight oe_read_only"/>
                    <button name="reject_incidence_button" states="draft" string="Reject" type="object" class="oe_highlight oe_read_only"/>
                    <button name="send_to_draft_button" states="approved,rejected" string="Send to Draft" type="object" class="oe_highlight oe_read_only"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1 class="o_row">
                            <field name="name" placeholder="Incidence title..."/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="employee_id"/>
                            <field name="check_in"/>
                            <field name="period_id"/>
                        </group>
                        <group>
                            <field name="type_incidence"/>
                            <field name="check_out"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Attendance incidence pivot view -->
    <record id="attendance_incidence_pivot_view" model="ir.ui.view">
        <field name="name">attendance.incidence.pivot.view</field>
        <field name="model">attendance.incidence</field>
        <field name="arch" type="xml">
            <pivot string="Incidences">
                <field name="single_count" type="measure"/>
                <field name="worked_hours" type="measure"/>
                <!-- <field name="check_in" type="col" interval="day"/> -->
                <field name="date_computed" type="col" interval="day"/>
                <field name="employee_id" type="row"/>
            </pivot>
        </field>
    </record>

    <!-- Attendance incidence search view -->
    <record id="attendance_incidence_search_view" model="ir.ui.view">
        <field name="name">attendance.incidence.search.view</field>
        <field name="model">attendance.incidence</field>
        <field name="arch" type="xml">
            <search string="Attendance Incidence Search">
                <field name="employee_id"/>
                <field name="department_id"/>
                <field name="period_id"/>
                <field name="name"/>
                <field name="structure_type_id"/>
                <field name="type_incidence"/>
                <field name="date_computed"/>
                <field name="check_in_hour"/>
                <field name="check_out_hour"/>
                <filter name="today" string="Today" domain="[('check_in', '&gt;=', datetime.datetime.now().replace(hour=0, minute=0, second=0)),('check_in', '&lt;=', datetime.datetime.now().replace(hour=23, minute=59, second=59))]" />
                <filter name="previous_period" string="Previous Periods" domain="[('prev_period', '=', True)]"/>
                <filter string="Current Month" domain="[('check_in', '&gt;=', datetime.datetime.now().strftime('%Y-%m-01'))]" />
                <separator/>
                <filter string="No Check Out" domain="[('check_out', '=', False)]" />
                <separator/>
                <filter string="My Incidences" domain="[('employee_id.user_id.id', '=', uid)]" />
                <separator/>
                <filter name="draft_incidence" string="Draft" domain="[('state', '=', 'draft')]"/>
                <filter name="app_incidence" string="Approved" domain="[('state', '=', 'approved')]"/>
                <filter name="rej_incidence" string="Rejected" domain="[('state', '=', 'rejected')]"/>
                <group expand="0" string="Group By">
                    <filter name="employee" string="Employee" context="{'group_by':'employee_id'}"/>
                    <separator/>
                    <filter name="groupby_name" string="Month" context="{'group_by':'check_in'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Attendance incidence action -->
    <record id="attendance_incidence_action" model="ir.actions.act_window">
        <field name="name">Attendance Incidences</field>
        <field name="res_model">attendance.incidence</field>
        <field name="view_mode">tree,form,pivot</field>
        <field name="domain">[]</field>
        <field name="context">{'search_default_previous_period': True, 'search_default_draft_incidence': True, 'custom_datetime_format': True}</field>
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Click here to create new incidence.
          </p>
        </field>
    </record>


    <!-- MENUS -->

    <!-- Principal attendance incidence menu -->
    <menuitem id="attendance_incidence_menu"
        groups="hr_attendance.group_hr_attendance_user,base.group_user"
        action="attendance_incidence_action"
        name="Attendance Incidences"
        parent="hr_attendance.menu_hr_attendance_manage_attendances"
        sequence="11"/>

</odoo>
