<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="mail_activity_search_view" model="ir.ui.view">
        <field name="name">mail.activity.search.view</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_search"/>
        <field name="arch" type="xml">
            <field name="res_model_id" position="after">
                <field name="res_model"/>
            </field>
        </field>
    </record>
     <record id="mail_activity_tree_view" model="ir.ui.view">
        <field name="name">mail.activity.tree.view</field>
        <field name="model">mail.activity</field>
        <field name="arch" type="xml">
            <tree string="Next Activities"
                   action='[{
                            "name": "Solve",
                            "act": "solve_activity_btn",
                            "method": "solve_activity_btn",
                            "src_model": "mail.activity"
                        }]'
                    decoration-danger="date_deadline &lt; current_date"
                    decoration-success="date_deadline == current_date"
                    default_order="date_deadline" create="false">
                <field name="tracking_state"/>
                <field name="status"/>
                <field name="res_model"/>
                <field name="res_name"/>
                <field name="activity_type_id"/>
                <field name="activity_source"/>
                <field name="summary"/>
                <field name="proposed_date"/>
                <field name="date_deadline"/>
                <field name="category_id"/>
                <field name="product_id"/>
                <field name="department_id"/>
                <field name="analytic_id"/>
                <field name="workcenter_ids" widget="many2many_tags"/>
                <field name="on_tracking_step" invisible="1"/>
                <field name="on_tracking_wo" invisible="1"/>
                <field name="on_tracking_activity" invisible="1"/>

                <button type="object" name="create_tracking_btn"
                        icon="fa-external-link-square" help="Do Tracking"
                        attrs="{'invisible': [('status', '=', 'active')]}"/>
                <button type="object" name="show_tracking_activity_btn"
                        icon="fa-clock-o" help="Show Activity Tracking"
                        attrs="{'invisible': [('on_tracking_activity', '!=', True)]}"/>
                <button type="object" name="show_tracking_step_btn"
                        icon="fa-clock-o" help="Show Step Tracking"
                        attrs="{'invisible': [('on_tracking_step', '!=', True)]}"/>
                <button type="object" name="show_tracking_wo_btn"
                        icon="fa-clock-o" help="Show Wo Tracking"
                        attrs="{'invisible': [('on_tracking_wo', '!=', True)]}"/>
            </tree>
        </field>
    </record>

    <record id="mail_activity_view_form_popup_inherit" model="ir.ui.view">
        <field name="name">mail.activity.view.form.popup.inherit</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_form_popup"/>
        <field name="arch" type="xml">
            <field name="activity_type_id" position="before">
                <field name="activity_source"/>
            </field>

            <field name="summary" position="after">
                <field name="res_analytic_id" string="Analytic"
                       attrs="{'invisible': [('activity_source', '=', 'normal')]}"/>
                <field name="manual_analytic_id"
                       attrs="{'invisible': [('activity_source', 'in', ('normal', 'pending'))]}"/>
            </field>
            <field name="user_id" position="replace">
                <field name="user_id" attrs="{'invisible': [('activity_source', '!=', 'normal')]}"/>
                <field name="category_id"
                       attrs="{'invisible': [('activity_source', '=', 'normal')],
                               'required': [('activity_source', '!=', 'normal')]}"
                       options="{'no_create': True, 'no_edit': True, 'no_open': True}"/>
                <field name="product_id"
                       attrs="{'invisible': [('activity_source', '=', 'normal')],
                               'required': [('activity_source', '!=', 'normal')]}"
                       options="{'no_create': True, 'no_edit': True, 'no_open': True}"/>
                <field name="department_id"
                       attrs="{'invisible': [('activity_source', '=', 'normal')],
                               'required': [('activity_source', 'not in', ('normal', 'pending'))]}"
                       options="{'no_create': True, 'no_edit': True, 'no_open': True}"/>
                <field name="workcenter_ids" widget="many2many_tags"
                       attrs="{'invisible': [('activity_source', '=', 'normal')],
                               'required': [('activity_source', 'not in', ('normal', 'pending'))]}"
                       options="{'no_create': True, 'no_edit': True, 'no_open': True}"
                       domain="[('resource_type', '=', 'alternative'),
                                ('department_id', '=', department_id),
                                ('period_group_id', '!=', False),
                                ('contract_id', '!=', False)]"/>
                <field name="tracking_state" widget="radio"
                       attrs="{'invisible': [('activity_source', 'in', ('normal', 'pending'))]}"/>
                <field name="workcenter_id" readonly="1"
                       attrs="{'invisible': [('activity_source', 'in', ('normal', 'pending'))]}"/>
                <field name="proposed_date" readonly="1"
                       attrs="{'invisible': [('activity_source', 'in', ('normal', 'pending'))]}"/>
                <field name="solved_date" readonly="1"
                       attrs="{'invisible': [('activity_source', 'in', ('normal', 'pending'))]}"/>
            </field>
        </field>
    </record>

</odoo>