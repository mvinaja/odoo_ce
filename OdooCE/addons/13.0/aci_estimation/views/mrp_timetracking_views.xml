<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="mrp_timetracking_input_view_tree" model="ir.ui.view">
        <field name="name">mrp.timetracking.input.view.tree</field>
        <field name="model">mrp.timetracking.input</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <tree edit="0" create="0" delete="0">
                <field name="workorder_id"/>
                <field name="step_id"/>
                <field name="date_start"/>
                <field name="date_end"/>
                <field name="duration"/>
                <field name="qty_progress"/>
            </tree>
        </field>
    </record>
    <record id="mrp_timetracking_workorder_search_view" model="ir.ui.view">
        <field name="name">mrp_timetracking_workorder_search_view</field>
        <field name="model">mrp.timetracking.workorder</field>
        <field name="arch" type="xml">
            <search string="Search ...">
                <field name="workcenter_id"/>
                <field name="planned_workcenter_id"/>
                <field name="workorder_id"/>
                <field name="analytic_id"/>
                <field name="period_id"/>
                <field name="period_group_id"/>
                <field name="production_id"/>
                <group expand="0" string="Group By">
                    <filter name='workorder_group' string="WorkOrder"
                            domain="[]" context="{'group_by': 'workorder_id'}"/>
                    <filter name='analytic_group' string="Analytic"
                            domain="[]" context="{'group_by': 'analytic_id'}"/>
                </group>
                <separator/>
                <filter name="trackstep" string="Can track step" domain="[('track_workstep', '=', True)]" />
                <filter name="type_mixed" string="Tracking Mixed" domain="[('timetracking_type', '=', 'mixed')]" />
                <filter name="type_wo" string="Tracking by workorder" domain="[('timetracking_type', '=', 'workorder')]" />
            </search>
        </field>
    </record>
    <record id="mrp_timetracking_workorder_view_gantt" model="ir.ui.view">
        <field name="name">mrp.timetracking.workorder.view.gantt</field>
        <field name="model">mrp.timetracking.workorder</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <gantt
                date_start="start_date"
                date_stop="end_date"
                default_group_by="workorder_id"
                default_scale="week"
                plan="false"
                scales="day,week,month,year"
                precision="{'day': 'hour:full', 'week': 'day:full', 'month': 'day:full', 'year': 'day:full'}"
                display_unavailability="1">

                <field name="workorder_id"/>
                <field name="start_date" />
                <field name="end_date"/>
                <field name="period_id"/>
                <field name="period_group_id"/>
                <field name="duration"/>
                <templates>
                    <div t-name="gantt-popover" class="container-fluid">
                        <div class="row no-gutters">
                            <div class="col">
                                <ul class="pl-1 mb-0">
                                    <li><strong>Start Date: </strong> <t t-esc="start_date.format('YYYY-MM-DD hh:mm:ss A')"/></li>
                                    <li><strong>Stop Date: </strong> <t t-esc="end_date.format('YYYY-MM-DD hh:mm:ss A')"/></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </templates>
            </gantt>
        </field>
    </record>
    <record id="mrp_timetracking_workorder_view_pivot" model="ir.ui.view">
        <field name="name">mrp.timetracking.workorder.view.pivot</field>
        <field name="model">mrp.timetracking.workorder</field>
        <field name="arch" type="xml">
            <pivot>
                <field name="ite_progress" type="measure" colored="inverted"/>
                <field name="analytic_id" type="row"/>
                <field name="party_id" type="col"/>
                <field name="product_tmpl_id" type="col"/>
                <field name="workcenter_id" type="col"/>
            </pivot>
        </field>
    </record>
    <record id="mrp_timetracking_workorder_view_pivot_estim" model="ir.ui.view">
        <field name="name">mrp.timetracking.workorder.view.pivot.estim</field>
        <field name="model">mrp.timetracking.workorder</field>
        <field name="arch" type="xml">
            <pivot>
                <field name="on_estimation" type="measure" colored="boolean"/>
                <field name="analytic_id" type="row"/>
<!--                <field name="party_id" type="col"/>-->
<!--                <field name="product_tmpl_id" type="col"/>-->
                <field name="workcenter_id" type="col"/>
            </pivot>
        </field>
    </record>
    <record id="mrp_timetracking_workorder_view_tree" model="ir.ui.view">
        <field name="name">mrp.timetracking.workorder.view.tree</field>
        <field name="model">mrp.timetracking.workorder</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <tree editable="bottom" create="0" decoration-info="main_period == False"
                  decoration-warning="ite_progress == 0"
                    action='[{
                        "name": "Change",
                        "act": "button_change_workcenter_estimation",
                        "views": [{"module": "aci_estimation", "xml_id": "mrp_timetracking_workcenter_wizard_form_view", "type": "form"}],
                        "binding_model": "mrp.timetracking.workorder",
                        "res_model": "mrp.timetracking.workcenter.wizard",
                        "mode": "model",
                        "context":{"model": "mrp.timetracking.workorder"}
                        },{
                            "title": "Randomize Mixed",
                            "icon": "btn-secondary fa fa-exchange",
                            "act": "random_tracking_btn",
                            "method": "random_tracking_btn",
                            "src_model": "mrp.timetracking.workorder"
                        },{
                            "title": "Change Tracking Type",
                            "icon": "btn-secondary fa fa-arrows-v",
                            "act": "change_tracking_btn",
                            "method": "change_tracking_btn",
                            "src_model": "mrp.timetracking.workorder"
                        },{
                            "title": "No Estimate",
                            "name": "No Estimate",
                            "act": "block_workorder_btn",
                            "method": "block_workorder_btn",
                            "src_model": "mrp.timetracking.workorder"
                        },{
                            "title": "Estimate",
                            "name": "Estimate",
                            "act": "open_workorder_btn",
                            "method": "open_workorder_btn",
                            "src_model": "mrp.timetracking.workorder"
                        },{
                            "title": "Create ITE",
                            "name": "Create ITE",
                            "act": "create_distribution_btn",
                            "method": "create_distribution_btn",
                            "src_model": "mrp.timetracking.workorder"
                        },{
                            "title": "Create Est.",
                            "name": "Create Est.",
                            "act": "process_replanning_btn",
                            "method": "process_replanning_btn",
                            "src_model": "mrp.timetracking.workorder"
                        },{
                            "title": "RFQ Flag",
                            "name": "RFQ Flag",
                            "act": "buy_required_btn",
                            "method": "buy_required_btn",
                            "src_model": "mrp.timetracking.workorder"
                        },{
                            "title": "Move Wo",
                            "icon": "btn-secondary fa fa-forward",
                            "act": "change_mtracking_btn",
                            "views": [{"module": "aci_estimation", "xml_id": "lbm_period_move_view_tree",
                                     "type": "list"}],
                            "binding_model": "mrp.timetracking.workorder",
                            "res_model": "lbm.period",
                            "mode": "model"
                        },
                        {
                            "title": "Activity Configurator",
                            "icon": "btn-secondary fa fa-clock-o",
                            "act": "activity_configurator_btn",
                            "views": [{"module": "aci_estimation", "xml_id": "mail_activity_configurator_form_view",
                                     "type": "form"}],
                            "binding_model": "mrp.timetracking.workorder",
                            "res_model": "mail.activity.configurator",
                            "mode": "model",
                            "context": {"source_res_model": "mrp.timetracking.workorder"}
                        }]'>
                <button name="show_estimation_btn" help="Show Estimation"  style="color:#7CA9DA;" type="object"
                        class="oe_stat_button" widget="statinfo" icon="fa-estimation-blue-sm"/>
                <field name="period_group_id" optional="hidden"/>
                <field name="period_id" readonly="1" optional="show"/>
                <field name="main_period" invisible="1"/>
                <button name="move_replanning_workorder_btn" type="object" help="Move ITE"
                        attrs="{'invisible': [('main_period', '=', True),
                                              ('replanning_progress', '&lt;=', 0)]}"
                        class="oe_stat_button" widget="statinfo" icon="fa-forward"/>
                <field name="period" readonly="1" optional="show"/>
                <field name="production_id" readonly="1" optional="hidden"/>
                <field name="product_tmpl_id" string="Workorder" optional="show"/>
                <field name="version" string="Ver." optional="show"/>
                <button name="show_workorder_btn" type="object" help="Open workorder"
                        class="oe_stat_button" widget="statinfo" icon="fa-external-link"/>
                <field name="analytic_name" optional="show"/>
                <field name="product_model" optional="show"/>
                <field name="planned_workcenter_code" readonly="1" optional="hidden"/>
                <field name="workcenter_code" readonly="1" optional="show"/>
                <field name="operators_qty" readonly="1" optional="show"/>
                <field name="planned_progress" readonly="1"  optional="show"/>
                <field name="ite_progress" readonly="1"  optional="show"/>
                <field name="accum_executed_progress" readonly="1"  optional="hidden"/>
                <field name="executed_progress" readonly="1"  optional="show"/>
                <field name="replanning_progress" readonly="1"  optional="show"/>
                <field name="planned_qty_progress" readonly="1"  optional="hidden"/>
                <field name="ite_qty_progress" readonly="1"  optional="hidden"/>
                <field name="executed_qty_progress" readonly="1"  optional="hidden"/>
                <field name="replanning_qty_progress" readonly="1"  optional="hidden"/>
                <field name="start_date" readonly="1" optional="hidden"/>
                <field name="end_date" readonly="1" optional="hidden"/>
                <field name="duration" readonly="1" optional="show"/>
                <field name="manage_type" optional="hidden"/>
                <field name="timetracking_type" optional="show"/>
                <field name="use_restriction" invisible="1"
                    groups="aci_estimation.group_estimation_chief" optional="show"/>
<!--                <field name="active_restriction_count"/>-->
<!--                <field name="can_be_planned" widget="boolean_toggle" optional="show"-->
<!--                       attrs="{'readonly': [('use_restriction', '=', True)]}"/>-->
                <field name="can_be_estimated" widget="boolean_toggle" optional="show"/>
                <field name="buy_required" widget="boolean_toggle" optional="show"/>
            </tree>
        </field>
    </record>
    <record id="mrp_timetracking_view_search" model="ir.ui.view">
        <field name="name">mrp.timetracking.view.search</field>
        <field name="model">mrp.timetracking</field>
        <field name="arch" type="xml">
            <search>
                <field name="period_id"/>
                <field name="baseline_id"/>
                <field name="product_id"/>
                <field name="workcenter_id"/>
                <field name="employee_id"/>
                <filter name="today" string="Today" domain="[('date_start', '&gt;=', datetime.datetime.now().replace(hour=0, minute=0, second=0)),
                    ('date_start', '&lt;=', datetime.datetime.now().replace(hour=23, minute=59, second=59))]" />

                <filter name="yesterday" string="Yesterday"
                        domain="[('date_start','&gt;=', ((context_today()-datetime.timedelta(days=1)).strftime('%Y-%m-%d 00:00:00'))), ('date_start','&lt;=', ((context_today()+datetime.timedelta(days=0)).strftime('%Y-%m-%d 00:00:00')))]" />

                <filter name="month" string="This Month"
                        domain="[
                            '&amp;',
                            ('date_start', '>=', (context_today() + relativedelta(day=1)).strftime('%Y-%m-%d')),
                            ('date_start', '&lt;=', (context_today() + relativedelta(months=1, day=1, days=-1)).strftime('%Y-%m-%d')),
                ]"/>
                <separator/>
                <filter name="has_restriction" string="Has Restriction" domain="[('has_restriction', '=', True)]" />
                <filter name="unlock_restriction" string="Release Restriction" domain="[('unlock_restriction', '=', True)]" />
                <separator/>
                <filter name="finished_stage" string="Finished Stage" domain="[('stage_id', '=', 'Finished')]" />
                <filter name="todo_stage" string="ToDo Stage" domain="[('stage_id', '=', 'ToDo')]" />
                <filter name="block_stage" string="Blocked Stage" domain="[('stage_id', '=', 'Blocked')]" />
                <filter name="working_stage" string="Working Stage" domain="[('stage_id', '=', 'Working')]" />
                <separator/>
                <filter name="active_stage" string="Active" domain="[('stage_id', 'in', ('Working', 'ToDo'))]" />
            </search>
        </field>
    </record>

       <record id="mrp_timetracking_gantt_view" model="ir.ui.view">
        <field name="name">mrp.timetracking.gantt.view</field>
        <field name="model">mrp.timetracking</field>
        <field name="arch" type="xml">
            <aci_gantt
                string="Timetracking gantt"
                date_start="date_start"
                date_stop="date_end"
                scale_zoom="week"
                sequence="id"
                orderby="workorder_id"
                party="party_id"
                nodes_model="mrp.timetracking"
                order="production_id,workorder_id"
                search_panel="true"
                control_panel="true"/>
        </field>
    </record>

    <record model="ir.ui.view" id="mrp_timetracking_kanban_view">
        <field name="name">mrp.timetracking.kanban.view</field>
        <field name="model">mrp.timetracking</field>
        <field name="arch" type="xml">
             <kanban default_group_by="category_filter" quick_create="false" class="o_kanban_dashboard o_project_kanban"
                     default_order="product_id"
                     workflow_columns="true" is_draggable_columns="true" group_create="0" group_delete="0"
                     group_edit="0" create="0">
                 <field name="id"/>
                 <field name="category_filter"/>
                 <field name="stage_id"/>
                 <field name="product_id"/>
                 <field name="has_restriction"/>
                 <field name="unlock_restriction"/>
                 <field name="step_type"/>
                 <field name="add_value"/>
                 <field name="restricted_qty"/>
                 <field name="workcenter_id"/>
                 <field name="analytic_id"/>
                 <field name="period_id"/>
                 <field name="tracking_origin"/>
                 <field name="bomline_wbs"/>
                 <field name="estimation_workcenter_id"/>
                 <field name="block_origin"/>
                 <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="step_status_#{record.stage_id.value}" style="height:auto;width:370px;">

                        <div style="position: absolute;
                                  right: 0px;
                                  top: 0px;
                                  z-index: 10;">
                             <button class="btn" style="color:green" name="button_null" type="object"
                                    help="Start Activity"
                                    attrs="{'invisible': [('block_origin', 'in', ('calendar', 'extra'))]}">
                                    <i class="fa fa-sign-in" />
                             </button>
                            <button class="btn"  style="color:red;" name="button_null" type="object"
                                    help="End Activity"
                                    attrs="{'invisible': [('block_origin', 'not in', ('calendar', 'extra'))]}">
                                    <i class="fa fa-sign-out"/>
                            </button>
                             <button class="btn" name="button_edit_estimation" type="object"
                                     attrs="{'invisible': [('step_type', '=', 'check')]}"
                                    help="Edit Estimation">
                                    <i class="fa fa-black-working-tracking" />
                             </button>
                        </div>
                            <div class="oe_kanban_content">
                                <div class="column_content" style="width:100%;">
                                        <span style="padding:3px; width:23.5px;">
                                        <t t-if="record.stage_id.raw_value != 'ToDo'">
                                            <t t-set="disable_check" t-value="undefined"/>
                                        </t>
                                        <t t-else="">
                                            <t t-set="disable_check" t-value="'disabled'"/>
                                        </t>
                                        <input type="checkbox" t-attf-id="check-to-move-#{record.id.raw_value}"
                                               t-attf-name="check-to-move-#{record.id.raw_value}"
                                               t-att-disabled="disable_check"
                                               style="padding:5px;" />
                                        </span>
                                        <t t-if="record.has_restriction.raw_value == true">
                                            <i class="fa fa-lock" style="color:#820000;"  title="Has Restriction"/>
                                        </t>
                                        <t t-if="record.unlock_restriction.raw_value == true">
                                            <i class="fa fa-door-key" style="color:#820000;"  title="Release Restriction"/>
                                        </t>
                                        <t t-if="record.step_type.raw_value == 'unit'">
                                            <i class="fa fa-circle" style="color:#992aaa;"  title="Unit"/>
                                        </t>
                                        <t t-if="record.step_type.raw_value == 'integer'">
                                            <i class="fa fa-th-large" style="color:#992aaa;"  title="Integer"/>
                                        </t>
                                        <t t-if="record.step_type.raw_value == 'float'">
                                            <i class="fa fa-adjust" style="color:#992aaa;"  title="Fraction"/>
                                        </t>
                                        <t t-if="record.step_type.raw_value == 'check'">
                                            <i class="fa fa-flash" style="color:#992aaa;"  title="Check"/>
                                        </t>
                                        <t t-if="record.step_type.raw_value == 'progress_qty'">
                                            <i class="fa fa-percent" style="color:#992aaa;"  title="Progress x QTY"/>
                                        </t>
                                        <t t-if="record.step_type.raw_value == 'progress_unit'">
                                            <i class="fa fa-percent" style="color:#992aaa;"  title="Progress x Unit"/>
                                            <i class="fa fa-circle" style="color:#992aaa;"  title="Unit"/>
                                        </t>

                                        <t t-if="record.restricted_qty.raw_value">
                                            <i class="fa fa-infinity" style="color:#e2c000;"  title=""/>

                                        </t><t t-if="record.add_value.raw_value">
                                            <i class="fa fa-star" style="color:#e2c000;"  title="Add Value"/>
                                        </t>
                                        <strong>
                                            <field name="short_name"/>
                                            <span style="color:#990000;">
                                                <field name="attribute_name"/>
                                            </span>
                                        </strong>
                                </div>
                                <div class="column_content" style="width:150px;">
                                    <t t-if="record.stage_id.value == 'ToDo'">
                                        <t t-set="todo" t-value="'disabled'"/>
                                        <t t-set="working" t-value="undefined"/>
                                        <t t-set="blocked" t-value="undefined"/>
                                        <t t-set="cancel" t-value="undefined"/>
                                    </t>
                                    <t t-elif="record.stage_id.value == 'Working'">
                                        <t t-set="todo" t-value="undefined"/>
                                        <t t-set="working" t-value="'disabled'"/>
                                        <t t-set="blocked" t-value="'disabled'"/>
                                        <t t-set="finished" t-value="'disabled'"/>
                                    </t>
                                    <t t-elif="record.stage_id.value == 'Blocked'">
                                        <t t-set="todo" t-value="'disabled'"/>
                                        <t t-set="working" t-value="'disabled'"/>
                                        <t t-set="blocked" t-value="undefined"/>
                                        <t t-set="cancel" t-value="'disabled'"/>
                                        <t t-set="finished" t-value="'disabled'"/>

                                    </t>
                                    <t t-elif="record.stage_id.value == 'Finished'">
                                        <t t-set="todo" t-value="'disabled'"/>
                                        <t t-set="working" t-value="'disabled'"/>
                                        <t t-set="blocked" t-value="'disabled'"/>
                                        <t t-set="finished" t-value="'disabled'"/>
                                        <t t-set="cancel" t-value="'disabled'"/>
                                    </t>
                                    <t t-elif="record.stage_id.value == 'Cancel'">
                                        <t t-set="todo" t-value="undefined"/>
                                        <t t-set="working" t-value="'disabled'"/>
                                        <t t-set="blocked" t-value="'disabled'"/>
                                        <t t-set="finished" t-value="'disabled'"/>
                                        <t t-set="cancel" t-value="'disabled'"/>
                                    </t>
                                    <t t-else="">
                                        <t t-set="todo" t-value="'disabled'"/>
                                        <t t-set="working" t-value="'disabled'"/>
                                        <t t-set="blocked" t-value="'disabled'"/>
                                        <t t-set="finished" t-value="'disabled'"/>
                                        <t t-set="cancel" t-value="'disabled'"/>
                                    </t>
                                    <div class="btn-group">
                                       <button class="btn tracking_gray_btn" name="button_detailed_form" type="object">
                                           <i  class="fa fa-external-link"/>
                                       </button>
                                       <button class="btn tracking_2x_btn" name="button_record_form" type="object"
                                       attrs="{'invisible': [('tracking_origin', '=', 'step')]}">
                                           <field name="percent_wo_complete"/>%
                                       </button>
                                       <button class="btn tracking_2x_btn" name="button_record_form" type="object"
                                       attrs="{'invisible': [('tracking_origin', '=', 'workorder')]}">
                                           <field name="percent_complete"/>/
                                           <field name="percent_wo_complete"/>%
                                       </button>
                                       <span class="activity_tracking">
                                            <field name="activity_ids" widget="kanban_activity" />
                                       </span>
                                    </div>
                                    <div class="btn-group">
                                        <button type="button"
                                                class="btn tracking_btn o_kanban_time_tracking_button_todo"
                                                t-att-data="record.id.raw_value"
                                                t-att-data-value="record.id.raw_value"
                                                t-att-disabled="todo">
                                            <i  class="fa fa_todo_tracking"/>
                                        </button>
                                        <button type="button"
                                                class="btn tracking_work_btn o_kanban_time_tracking_button_working"
                                                id="o_working_button"
                                                t-att-data-value="record.id.raw_value"
                                                t-att-disabled="working">
                                            <i class="fa fa_working_tracking"/>
                                        </button>
                                        <button type="button"
                                                class="btn tracking_btn o_kanban_time_tracking_button_blocked"
                                                id="o_disabled_button"
                                                t-att-data-value="record.id.raw_value"
                                                t-att-disabled="blocked">
                                            <i class="fa fa_locked_tracking"/>
                                        </button>
<!--                                        <button type="button"-->
<!--                                                class="btn tracking_btn o_kanban_time_tracking_button_finished"-->
<!--                                                t-att-data-value="record.id.raw_value"-->
<!--                                                t-att-disabled="finished">-->
<!--                                            <i class="fa fa_finished_tracking"/>-->
<!--                                        </button>-->
                                    </div>
                                </div>
                                <div class="column_content" style="width:185px;">
                                    <strong style="color:#0575ff;"><field name="date_end_day"/></strong>
                                    <br></br>
                                     <button class="btn" name="button_blocks" type="object"
                                            help="Daily Activity Block">
                                            <i class="fa-block-sm" />
                                     </button>
                                    <field name="workcenter_code" />
                                    <br></br>
                                     <button class="btn" name="button_activity" type="object"
                                            help="Daily Activity Records">
                                            <i class="fa-input-sm" />
                                     </button>
                                    <field name="analytic_id_name"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record model="ir.ui.view" id="mrp_timetracking_form_view_quality">
        <field name="name">mrp.timetracking.form.view.quality</field>
        <field name="model">mrp.timetracking</field>
        <field name="arch" type="xml">
            <form string="Quality Alerts" create="false">
                    <header>
                        <button name="create_quality_alert" type="object" string="Create" class="btn btn-primary"/>
                    </header>
                <sheet>
                    <field name="quality_alert_ids">
                        <tree create="0" edit="0">
                            <field name="stage_id" optional="show"/>
                            <field name="lock_product" optional="show"/>
                            <field name="workcenter_id" optional="show"/>
                            <field name="name" optional="show"/>
                            <field name="product_tmpl_id" optional="show"/>
                            <field name="product_id" optional="hide"/>
                            <field name="lot_id" optional="hide"/>
                            <field name="team_id" optional="show"/>
                            <field name="user_id" optional="show"/>
                            <field name="tag_ids" optional="hide" widget="many2many_tags"/>
                            <field name="reason_id" optional="hide"/>
                            <field name="priority" optional="hide"/>
                            <field name="date_assign" optional="show"/>
                            <field name="partner_id" optional="hide"/>
                        </tree>
                    </field>
                </sheet>
            </form>
        </field>
    </record>
      <record model="ir.ui.view" id="mrp_timetracking_form_view">
        <field name="name">mrp.timetracking.form.view</field>
        <field name="model">mrp.timetracking</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <form string="Timetracking" create="false">
                <header>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button type="object" name="null_button" class="oe_stat_button" icon="fa-clock-o">
                            <field name="accum_time" widget="float_time" readonly="1"/>
                        </button>
                        <button type="object" name="null_button" icon="fa-check-square-o" class="oe_stat_button">
                            <field name="stage_id" readonly="1"/>
                        </button>
                    </div>
                        <field name="available" invisible="1"/>
                        <widget name="web_ribbon" text="Disable" bg_color="bg-danger"
                                attrs="{'invisible': [('available', '=', True)]}"/>
                        <field name="has_restriction" invisible="1"/>
                        <field name="unlock_restriction" invisible="1"/>
                        <field name="add_value" invisible="1"/>
                        <field name="restricted_qty" invisible="1"/>
                        <field name="step_type" invisible="1"/>
                        <i attrs="{'invisible': [('has_restriction', '!=', True)]}" class="fa fa-lock fa-2x" style="color:#820000;margin:5px;"  title="Release Restriction"/>
                        <i attrs="{'invisible': [('unlock_restriction', '!=', True)]}" class="fa fa-door-key fa-2x" style="color:#820000;margin:5px;"  title="Release Restriction"/>
                        <i attrs="{'invisible': [('step_type', '!=', 'unit')]}" class="fa fa-circle fa-2x" style="color:#992aaa;margin:5px;"  title="Unit"/>
                        <i attrs="{'invisible': [('step_type', '!=', 'float')]}" class="fa fa-adjust fa-2x" style="color:#992aaa;margin:5px;"  title="Fraction"/>
                        <i attrs="{'invisible': [('step_type', '!=', 'integer')]}" class="fa fa-th-large fa-2x" style="color:#992aaa;margin:5px;"  title="Integer"/>
                        <i attrs="{'invisible': [('step_type', '!=', 'check')]}" class="fa fa-flash fa-2x" style="color:#992aaa;margin:5px;"  title="Check"/>
                        <i attrs="{'invisible': [('step_type', '!=', 'progress_qty')]}" class="fa fa-percent fa-2x" style="color:#992aaa;margin:5px;"  title="Check"/>
                        <i attrs="{'invisible': [('step_type', '!=', 'progress_unit')]}" class="fa fa-percent fa-2x" style="color:#992aaa;margin:5px;"  title="Check"/>
                        <i attrs="{'invisible': [('step_type', '!=', 'progress_unit')]}" class="fa fa-circle fa-2x" style="color:#992aaa;margin:5px;"  title="Unit"/>
                        <i attrs="{'invisible': [('add_value', '!=', True)]}" class="fa fa-star fa-2x" style="color:#e2c000;margin:5px;"  title="Add Value"/>
                        <i attrs="{'invisible': [('restricted_qty', '!=', True)]}" class="fa fa-infinity fa-2x" style="color:white;border-top-style:solid;border-top-width:10px;width:35px;height:30px;"  title="Infinite Qty"/>
                    <div class="oe_title">
                        <h1><field name="product_id" readonly="1"/></h1>
                    </div>
                    <group colspan="4" col="2">
                        <field name="workcenter_id" readonly="1"/>
                        <field name="step_id" readonly="1"/>
                        <field name="workorder_id" readonly="1"/>
                        <field name="production_id" readonly="1"/>
                        <field name="analytic_id" readonly="1"/>
                        <field name="period_id" readonly="1"/>
                        <field name="category_filter" readonly="1"/>
                        <field name="percent_complete" readonly="1" string="Record Progress"/>
                        <field name="percent_wo_complete" readonly="1" string="Wo Progress"/>
                    </group>
                    <notebook>
                        <page string="Tracking Records">
                            <field name="tracking_ids" nolabel="1">
                                <tree create="false" editable="top" delete="false" decoration-danger="is_productivity==False">
                                    <field name="workorder_id" invisible="1" optional="show"/>
                                    <field name="analytic_id"
                                           options="{'no_create': True, 'no_open': True}"/>
                                    <field name="date_start" readonly="1" optional="hidden"/>
                                    <field name="final_start_date" optional="hidden"/>
                                    <field name="date_end" readonly="1" optional="hidden"/>
                                    <field name="final_end_date" optional="hidden"/>
                                    <field name="duration" readonly="1" widget="float_time" optional="show"/>
                                    <field name="worked_duration" readonly="1" widget="float_time" optional="show"/>
                                    <field name="worked_rate" readonly="1" optional="hidden"/>
<!--                                    <field name="qty_manual" readonly="1" optional="show"/>-->
                                    <field name="progress" readonly="1" optional="hidden"/>
                                    <field name="qty_progress" readonly="1" optional="show"
                                        attrs="{'required': [('qty_operators', '!=', False), ('qty_operators', '>', 0)]}"/>
                                    <field name="rate_uom" optional="show"/>
                                    <field name="qty_operators" readonly="1" optional="hidden"
                                        attrs="{'required': [('qty_progress', '!=', False), ('qty_progress', '>', 0)]}"/>
                                    <field name="resource_id" readonly="1" string="Work Center" optional="show"/>
                                    <field name="loss_id" readonly="1" string="Efficiency"  optional="hidden"/>
                                    <field name="is_productivity" invisible="1"/>
                                    <field name="note" optional="hidden"/>
                                    <field name="step_id" readonly="1"  optional="show"/>
                                    <field name="employee_ids" readonly="1" widget="many2many_tags"  optional="show"/>
                                    <field name="restriction_ids" readonly="1" widget="many2many_tags"  optional="show"/>
                                      <button name="open_form" icon="fa-external-link-square" type="object" help="Open"
                                            context="{'id_domain': id}"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids" options="{'open_attachments': True}"/>
                </div>
            </form>
        </field>
    </record>

    <record id="mrp_timetracking_calendar_view" model="ir.ui.view">
            <field name="name">mrp.timetracking.calendar.view</field>
            <field name="model">mrp.timetracking</field>
            <field name="arch" type="xml">
                <calendar date_start="date_start" date_stop="date_end"
                          string="Activity" mode="month" color="workcenter_id"
                          event_limit="5" event_open_popup="True">
                    <field name="employee_id" avatar_field="image_128"/>
                    <field name="workcenter_id"/>
                    <field name="date_start"/>
                    <field name="date_end"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                </calendar>
            </field>
        </record>

    <!-- Menu items -->
        <record id="ir_actions_server_timetracking_step" model="ir.actions.server">
            <field name="name">Timetracking: By Step</field>
            <field name="model_id" ref="aci_estimation.model_mrp_timetracking"/>
            <field name="state">code</field>
            <field name="code">action = model.action_tracking_step_redirect()</field>
        </record>
        <record id="ir_actions_server_timetracking_step_active" model="ir.actions.server">
            <field name="name">Timetracking Active: By Step</field>
            <field name="model_id" ref="aci_estimation.model_mrp_timetracking"/>
            <field name="state">code</field>
            <field name="code">action = model.action_tracking_step_active_redirect()</field>
        </record>

    <menuitem id="menu_tracking_step_catalog"
            name="Step"
            sequence="5"
            parent="aci_estimation.menu_estimation_app"/>

    <menuitem id="menu_tracking_active_step_catalog"
            name="Currently Active"
            sequence="1"
            action="aci_estimation.ir_actions_server_timetracking_step_active"
            parent="menu_tracking_step_catalog"/>

    <menuitem id="menu_tracking_all_step_catalog"
            name="All"
            sequence="2"
            action="aci_estimation.ir_actions_server_timetracking_step"
            parent="menu_tracking_step_catalog"/>


        <record id="ir_actions_server_timetracking_wo" model="ir.actions.server">
            <field name="name">Timetracking: By WorkOrder</field>
            <field name="model_id" ref="aci_estimation.model_mrp_timetracking"/>
            <field name="state">code</field>
            <field name="code">action = model.action_tracking_wo_redirect()</field>
        </record>
        <record id="ir_actions_server_timetracking_wo_active" model="ir.actions.server">
            <field name="name">Timetracking Active: By WorkOrder</field>
            <field name="model_id" ref="aci_estimation.model_mrp_timetracking"/>
            <field name="state">code</field>
            <field name="code">action = model.action_tracking_wo_active_redirect()</field>
        </record>


    <menuitem id="menu_tracking_workorder_catalog"
            name="WorkOrder"
            sequence="6"
            parent="aci_estimation.menu_estimation_app"/>

        <menuitem id="menu_tracking_active_workorder_catalog"
            name="Currently Active"
            sequence="1"
            action="aci_estimation.ir_actions_server_timetracking_wo_active"
            parent="menu_tracking_workorder_catalog"/>

    <menuitem id="menu_tracking_all_workorder_catalog"
            name="All"
            sequence="2"
            action="aci_estimation.ir_actions_server_timetracking_wo"
            parent="menu_tracking_workorder_catalog"/>
<!--    Configuration -->

        <record id="action_server_timetracking_estimation" model="ir.actions.server">
            <field name="name">Timetracking: Estimation</field>
            <field name="model_id" ref="aci_estimation.model_mrp_timetracking"/>
            <field name="state">code</field>
            <field name="code">action = model.action_dashboard_estimation_redirect()</field>
        </record>

        <menuitem id="menu_timetracking_estimation"
            name="Estimations"
            sequence="1"
            action="action_server_timetracking_estimation"
            parent="aci_estimation.menu_estimation_app"/>

        <!-- Productivity Blocks        -->

        <record id="action_estimation" model="ir.actions.act_window">
                <field name="name">Estimations</field>
                <field name="type">ir.actions.act_window</field>
                <field name="res_model">mrp.estimation</field>
                <field name="view_mode">tree,form</field>
                <field name="search_view_id" ref="mrp_estimation_view_search"/>
        </record>
        <record id="action_timetracking_productivity" model="ir.actions.act_window">
                <field name="name">Productivity Block</field>
                <field name="type">ir.actions.act_window</field>
                <field name="res_model">hr.productivity.block</field>
                <field name="view_mode">tree,timeline</field>
                <field name="context">{"search_default_today":1}</field>
                <field name="search_view_id" ref="aci_estimation.search_hr_productivity_block"/>
        </record>

        <menuitem id="menu_timetracking_operation"
            name="Operations"
            sequence="10"
            parent="aci_estimation.menu_estimation_app"
            groups="aci_estimation.group_estimation_manager"/>

        <menuitem id="menu_mrp_production_workcenter_tracking"
    name="Workcenters on Production"
    parent="menu_timetracking_operation"
    action="mrp_production_workcenter_action"
    sequence="10"/>

        <menuitem id="menu_estimation"
            name="Estimations"
            sequence="3"
            action="action_estimation"
            parent="menu_timetracking_operation"/>

            <menuitem id="menu_timetracking_cron_estimation"
            name="Run Estimation"
            sequence="1"
            action="ir_actions_server_manual_estimation"
            parent="menu_timetracking_operation"/>

        <menuitem id="menu_timetracking_productivity"
            name="Productivity Blocks"
            sequence="5"
            action="action_timetracking_productivity"
            parent="menu_timetracking_operation"/>

        <record id="mrp_timetracking_tree_view" model="ir.ui.view">
            <field name="name">mrp.timetracking.tree.view</field>
            <field name="model">mrp.timetracking</field>
            <field name="arch" type="xml">
                <tree action='[{
                        "name": "Change",
                        "act": "button_change_workcenter_estimation",
                        "views": [{"module": "aci_estimation", "xml_id": "mrp_timetracking_workcenter_wizard_form_view", "type": "form"}],
                        "binding_model": "mrp.timetracking",
                        "res_model": "mrp.timetracking.workcenter.wizard",
                        "mode": "model",
                        "context": {"model": "mrp.timetracking"}
                        }]' decoration-success="active_on_period == True">
                    <field name="warehouse_id" optional="hidden"/>
                    <field name="baseline_id" optional="hidden"/>
                    <field name="period_group_id" string="PGp" optional="hidden"/>
                    <field name="period_id" string="BL Per." optional="hidden"/>
                    <field name="production_id" optional="hidden"/>
                    <field name="analytic_id" optional="hidden"/>
                    <button type="object" name="button_edit_estimation"
                            help="Estimate" icon="fa-black-working-tracking"
                           attrs="{'invisible': [('step_type', '=', 'check')]}"/>
                    <button type="object" name="button_quality_alert_planned"
                            help="Quality Alert" icon="fa-locked-tracking-black"/>
                    <button type="object" name="button_activity"
                            help="Activity" icon="fa-clock-o"/>
                    <field name="analytic_id_name" string="Analytic" optional="show"/>
                    <field name="product_model" string="Mod." optional="show"/>
                    <field name="product_tmpl_id" string="Product" optional="show"/>

                    <button type="object" name="show_workorder_btn"
                            icon="fa-external-link" help="Form View"/>
                    <field name="version" optional="show"/>
                    <field name="step_type" invisible="1" optional="show"/>
                    <field name="tracking_origin" optional="hidden"/>
                    <field name="expected_wo_percentage" string="WO %" optional="show"/>
                    <field name="expected_percentage" string="%" optional="hidden"/>
                    <field name="expected_qty" optional="show"/>
                    <field name="product_uom_id" string="UOM" optional="hidden"/>
                    <field name="percent_complete" string="% Done" optional="hidden"/>
                    <field name="percent_wo_complete" string="% Wo Done" optional="show"/>
                    <field name="date_start" optional="hidden"/>
                    <field name="date_end" optional="hidden"/>
                    <field name="duration_expected" optional="show"/>
                    <field name="workcenter_code" optional="show"/>
                    <button type="object" name="button_detailed_form"
                            icon="fa-external-link" help="Form View"/>
                    <field name="active_on_period" optional="hidden"/>
                </tree>
            </field>
        </record>

        <record id="action_mrp_workorder_restriction" model="ir.actions.act_window">
                <field name="name">WorkOrder Restrictions</field>
                <field name="type">ir.actions.act_window</field>
                <field name="res_model">mail.activity</field>
                <field name="view_id" ref="mail_activity_tree_view"/>
                <field name="context">{'search_default_res_model': 'workorder'}</field>
                <field name="view_mode">tree</field>
        </record>

        <record id="action_mrp_timetracking_workorder" model="ir.actions.act_window">
                <field name="name">Mrp Timetracking Workorders</field>
                <field name="type">ir.actions.act_window</field>
                <field name="res_model">mrp.timetracking.workorder</field>
                <field name="view_mode">tree</field>
        </record>

        <menuitem id="menu_mrp_timetracking_workorder_record"
            name="WorkOrder ITE"
            sequence="10"
            action="action_mrp_timetracking_workorder"
            parent="menu_timetracking_operation"/>

        <record id="action_timetracking_record" model="ir.actions.act_window">
                <field name="name">TimeTracking Records</field>
                <field name="type">ir.actions.act_window</field>
                <field name="res_model">mrp.timetracking</field>
                <field name="view_mode">tree</field>
        </record>

        <menuitem id="menu_timetracking_record"
            name="Daily activity Records"
            sequence="15"
            action="action_timetracking_record"
            parent="menu_timetracking_operation"/>

        <menuitem id="menu_mrp_workorder_restriction"
        name="WO Restrictions"
        parent="mrp.menu_mrp_manufacturing"
        action="action_mrp_workorder_restriction"
        sequence="35"/>

    <menuitem id="menu_mrp_timetracking_records"
        name="Timetracking Records"
        parent="mrp.menu_mrp_manufacturing"
        action="action_timetracking_record"
        sequence="40"/>

    <menuitem id="menu_timetracking_log"
        name="TimeTracking Log"
        sequence="25"
        parent="menu_timetracking_operation"/>

    <menuitem id="menu_step_productivity_tracking"
        name="Step"
        parent="menu_timetracking_log"
        action="aci_estimation.lbm_work_order_step_productivity_tree_action"
        sequence="1"/>

    <menuitem id="menu_workorder_productivity_tracking"
        name="WorkOrder"
        parent="menu_timetracking_log"
        action="aci_estimation.mrp_workorder_productivity_tree_action"
        sequence="5"/>

     <menuitem
    id="menu_mrp_plm_workcenters_alternative"
    name="Work Centers Alternative"
    parent="menu_timetracking_operation"
    action="aci_product.mrp_workcenter_alternative_action"
    sequence="30"/>

    <menuitem id="menu_monitoring"
        name="Monitoring"
        sequence="35"
        parent="menu_timetracking_operation"/>

     <record id="action_ite_monitoring" model="ir.actions.act_window">
        <field name="name">ITE Monitoring</field>
        <field name="res_model">mrp.timetracking.workorder</field>
        <field name="view_mode">pivot</field>
        <field name="view_ids"
           eval="[(5, 0, 0), (0, 0, {'view_mode': 'pivot', 'view_id': ref('mrp_timetracking_workorder_view_pivot')})]"/>
    </record>

    <menuitem id="menu_monitoring_ite"
        name="ITE"
        parent="menu_monitoring"
        action="aci_estimation.action_ite_monitoring"
        sequence="1"/>


     <record id="action_estim_monitoring" model="ir.actions.act_window">
        <field name="name">Estimation Monitoring</field>
        <field name="res_model">mrp.timetracking.workorder</field>
        <field name="view_mode">pivot</field>
        <field name="view_ids"
           eval="[(5, 0, 0), (0, 0, {'view_mode': 'pivot', 'view_id': ref('mrp_timetracking_workorder_view_pivot_estim')})]"/>
    </record>

        <menuitem id="menu_monitoring_estim"
        name="Estimation"
        parent="menu_monitoring"
        action="aci_estimation.action_estim_monitoring"
        sequence="2"/>

     <record id="action_wo_monitoring" model="ir.actions.act_window">
        <field name="name">WO Monitoring</field>
        <field name="res_model">mrp.workorder.monitoring</field>
        <field name="view_mode">pivot</field>
        <field name="view_ids"
           eval="[(5, 0, 0), (0, 0, {'view_mode': 'pivot', 'view_id': ref('mrp_workorder_monitoring_pivot_view')})]"/>
    </record>

    <menuitem id="menu_monitoring_wo"
        name="WorkOrder"
        parent="menu_monitoring"
        action="aci_estimation.action_wo_monitoring"
        sequence="3"/>

</odoo>
