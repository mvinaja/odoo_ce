<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="sale_order_line_ikom_form_view" model="ir.ui.view">
            <field name="name">sale_order_line_ikom_form_view</field>
            <field name="model">sale.order.line</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <field name="product_tmpl_id" readonly="1"/>
                            <field name="product_id" readonly="1"/>
                            <field name="name" readonly="1"/>
                        </group>
                        <group>
                            <field name="order_id" readonly="1"/>
                            <field name="package_id" readonly="1"/>
                            <field name="package_categ_id" readonly="1"/>
                            <field name="lot_id" readonly="1"/>
                        </group>
                        <group>
                            <field name="product_uom_qty" readonly="1"/>
                            <field name="product_uom" readonly="1"/>
                            <field name="price_unit" readonly="1"/>
                            <field name="price_subtotal" readonly="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="sale_order_line_ikom_tree_view" model="ir.ui.view">
            <field name="name">sale_order_line_ikom_tree_view</field>
            <field name="model">sale.order.line</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="order_id" readonly="1"/>
                    <field name="package_id" readonly="1"/>
                    <field name="package_categ_id" readonly="1"/>
                    <field name="product_tmpl_id" readonly="1"/>
                    <field name="product_id" readonly="1"/>
                    <field name="lot_id" readonly="1"/>
                    <field name="product_uom_qty" readonly="1"/>
                    <field name="product_uom" readonly="1"/>
                    <field name="price_unit" readonly="1"/>
                    <field name="price_subtotal" readonly="1"/>
                </tree>
            </field>
        </record>

        <record id="sale_order_line_ikom_search_view" model="ir.ui.view">
            <field name="name">sale_order_line_ikom_tree_view</field>
            <field name="model">sale.order.line</field>
            <field name="arch" type="xml">
                <search string="Search">
                    <field name="order_id"/>
                    <field name="product_tmpl_id"/>
                    <field name="product_id"/>
                    <field name="lot_id"/>
                    <group expand="0" string="Group By">
                        <filter string="Orders" name="order" context="{'group_by': 'order_id'}"/>
                        <filter string="Product Template" name="template" context="{'group_by': 'product_tmpl_id'}"/>
                        <filter string="Product" name="product" context="{'group_by': 'product_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="action_ikom_lot" model="ir.actions.act_window">
            <field name="name">IKOM Lots</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order.line</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="sale_order_line_ikom_search_view"/>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('ikom.sale_order_line_ikom_tree_view')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('ikom.sale_order_line_ikom_form_view')})]"/>
            <field name="domain">[('package_id', '!=', False)]</field>
        </record>

        <menuitem id="menu_ikom_lots"
                action="action_ikom_lot"
                parent="sale.sale_order_menu"
                sequence="2" groups="sales_team.group_sale_salesman"/>

<!--        PDF REPORT-->

        <report string="IKOM Lots" id="action_report_ikom_lot"
                model="sale.order.line" name="ikom.lot_report"
                file="ikom.lot_report" report_type="qweb-pdf"
                print_report_name="IKOM Lots" />

        <template id="lot_report">
            <t t-call="web.html_container">
                <t t-call="web.internal_layout">
                    <table style="border: 1pt solid black; border-collapse:separate; width: 100%;">
                            <tr>
                                <th style="border: 1px solid black; background-color:gray;">Order</th>
                                <th style="border: 1px solid black; background-color:gray;">IKOM Pack.</th>
                                <th style="border: 1px solid black; background-color:gray;">Type</th>
                                <th style="border: 1px solid black; background-color:gray;">Product</th>
                                <th style="border: 1px solid black; background-color:gray;">Specs.</th>
                                <th style="border: 1px solid black; background-color:gray;">Lot</th>
                                <th style="border: 1px solid black; background-color:gray;">Qty</th>
                                <th style="border: 1px solid black; background-color:gray;">UOM</th>
                                <th style="border: 1px solid black; background-color:gray;">Price</th>
                            </tr>
                    <t t-foreach="docs" t-as="line">
                            <tr>
                                <td style="border: 1px solid black;"><t t-esc="line.order_id.name"/></td>
                                <td style="border: 1px solid black;"><t t-esc="line.package_id.name"/></td>
                                <td style="border: 1px solid black;"><t t-esc="line.package_categ_id.name"/></td>
                                <td style="border: 1px solid black;"><t t-esc="line.product_tmpl_id.name"/></td>
                                <td style="border: 1px solid black;"><t t-esc="line.product_id.name"/></td>
                                <td style="border: 1px solid black;"><t t-esc="line.lot_id.name"/></td>
                                <td style="border: 1px solid black;"><t t-esc="line.product_uom_qty"/></td>
                                <td style="border: 1px solid black;"><t t-esc="line.product_uom.name"/></td>
                                <td style="border: 1px solid black;"><t t-esc="line.price_subtotal"/></td>
                            </tr>
                    </t>
                    </table>
                </t>
            </t>
        </template>

        <record id="ir_actions_server_ikom_report" model="ir.actions.server">
            <field name="name">IKOM Lots PDF</field>
            <field name="model_id" ref="sale.model_sale_order_line"/>
            <field name="state">code</field>
            <field name="code">action = model._create_report()</field>
        </record>

        <menuitem id="menu_ikom_lots_report"
                action="ir_actions_server_ikom_report"
                parent="sale.sale_order_menu"
                sequence="2" groups="sales_team.group_sale_salesman"/>
    </data>
</odoo>